ç« èŠ‚1: æœåŠ¡å™¨ç«¯å£ï¼šæ•°å­—ä¸–ç•Œçš„é—¨ç‰Œå·
å¤§å®¶å¥½ï¼ä»Šå¤©æ¥èŠèŠä¸€ä¸ªçœ‹ä¼¼ç®€å•ä½†è¶…çº§é‡è¦çš„åŸºç¡€è®¾æ–½è¯é¢˜: æœåŠ¡å™¨ç«¯å£ï¼ˆPortï¼‰ã€‚
å¦‚æœæŠŠæœåŠ¡å™¨æ¯”ä½œä¸€æ ‹å¤§æ¥¼ï¼Œé‚£ç«¯å£å°±åƒæ˜¯æ¯ä¸ªæˆ¿é—´çš„é—¨ç‰Œå·ï¼Œæ²¡æœ‰å®ƒä»¬ï¼Œä½ å°±æ‰¾ä¸åˆ°ä»»ä½•æœåŠ¡ï¼
1ï¸âƒ£ ç«¯å£æ˜¯ä»€ä¹ˆï¼ŸæœåŠ¡å™¨çš„"é—¨ç‰Œå·" ğŸ 
æƒ³è±¡ä¸€ä¸‹ï¼Œä½ è¦å»ä¸€æ ‹å†™å­—æ¥¼æ‰¾å…¬å¸ã€‚ä½ çŸ¥é“å…¬å¸åœ¨"ç§‘æŠ€å¤§å¦"ï¼Œä½†è¿™æ ‹æ¥¼æœ‰50å±‚ã€æ¯å±‚20ä¸ªæˆ¿é—´ï¼Œæ²¡æœ‰é—¨ç‰Œå·ä½ æ€ä¹ˆæ‰¾ï¼Ÿç«¯å£å°±æ˜¯è¿™ä¸ªé—¨ç‰Œå·ï¼
æœåŠ¡å™¨ç«¯å£çš„ä½œç”¨ï¼š
ğŸ‘‰ å”¯ä¸€æ ‡è¯†ï¼šæ¯ä¸ªç«¯å£å¯¹åº”ä¸€ä¸ªç‰¹å®šçš„æœåŠ¡
ğŸ‘‰ æµé‡åˆ†å‘ï¼šä¸åŒçš„è¯·æ±‚é€šè¿‡ä¸åŒç«¯å£è¿›å…¥ä¸åŒæœåŠ¡
ğŸ‘‰ èµ„æºéš”ç¦»ï¼šå„ä¸ªæœåŠ¡äº’ä¸å¹²æ‰°ï¼Œå„è‡ªå ç”¨ç‹¬ç«‹ç«¯å£
ğŸ‘‰ å¹¶å‘å¤„ç†ï¼šåŒä¸€å°æœåŠ¡å™¨å¯ä»¥åŒæ—¶æä¾›å¤šç§æœåŠ¡
ä¸¾ä¸ªä¾‹å­ğŸŒ°ï¼Œå¦‚å›¾2ä¸­æ‰€åˆ—ä¸¾çš„ç«¯å£ï¼Œå°±åƒå†™å­—æ¥¼é‡Œï¼š
ğŸ‘‰ 22ç«¯å£ = ä¿å®‰å®¤ï¼ˆSSHè¿œç¨‹ç™»å½•ï¼‰
ğŸ‘‰ 80ç«¯å£ = å‰å°å¤§å…ï¼ˆHTTPç½‘ç«™æœåŠ¡ï¼‰
ğŸ‘‰ 443ç«¯å£ = VIPæ¥å¾…å®¤ï¼ˆHTTPSå®‰å…¨æœåŠ¡ï¼‰
ğŸ‘‰ 3306ç«¯å£ = æ¡£æ¡ˆå®¤ï¼ˆMySQLæ•°æ®åº“ï¼‰
2ï¸âƒ£ å¯¹å¤–æœåŠ¡å¿…é¡»æœ‰ç«¯å£ï¼šæ²¡é—¨ç‰Œå·å°±æ˜¯"é»‘æˆ·" ğŸšª
åœ¨æ•°å­—ä¸–ç•Œé‡Œï¼Œä»»ä½•æƒ³è¦å¯¹å¤–æä¾›æœåŠ¡çš„åº”ç”¨éƒ½å¿…é¡»æœ‰ç«¯å£ï¼Œè¿™æ˜¯é“å¾‹ï¼å°±åƒå…¬å¸å¿…é¡»æœ‰é—¨ç‰Œå·ä¸€æ ·ï¼Œæ²¡æœ‰ç«¯å£çš„æœåŠ¡å°±æ˜¯"é»‘æˆ·"ï¼Œè°ä¹Ÿæ‰¾ä¸åˆ°ã€‚
ä¸ºä»€ä¹ˆæ‰€æœ‰å¯¹å¤–æœåŠ¡éƒ½éœ€è¦ç«¯å£ï¼Ÿ
ç½‘ç»œé€šä¿¡çš„åŸºæœ¬åŸç†ï¼š
ğŸ‘‰ IPåœ°å€ï¼šç¡®å®šæ˜¯å“ªå°æœåŠ¡å™¨ï¼ˆå“ªæ ‹æ¥¼ï¼‰
ğŸ‘‰ ç«¯å£å·ï¼šç¡®å®šæ˜¯å“ªä¸ªæœåŠ¡ï¼ˆå“ªä¸ªæˆ¿é—´ï¼‰
ğŸ‘‰ åè®®ï¼šç¡®å®šæ€ä¹ˆé€šä¿¡ï¼ˆæ•²é—¨æ–¹å¼ï¼‰
3ï¸âƒ£ ç«¯å£åˆ†ç±»
ğŸ‘‰ çŸ¥åç«¯å£ï¼ˆ0-1023ï¼‰ï¼šç³»ç»Ÿä¿ç•™ï¼Œéœ€è¦ç®¡ç†å‘˜æƒé™
ğŸ‘‰ æ³¨å†Œç«¯å£ï¼ˆ1024-49151ï¼‰ï¼šåº”ç”¨ç¨‹åºä½¿ç”¨
ğŸ‘‰ åŠ¨æ€ç«¯å£ï¼ˆ49152-65535ï¼‰ï¼šä¸´æ—¶åˆ†é…ä½¿ç”¨
4ï¸âƒ£ ç«¯å£ç›‘æ§ï¼šSREçš„"å®‰å…¨å·¡é€»" ğŸ‘®â€â™‚ï¸
ä½œä¸ºSREï¼Œç«¯å£ç›‘æ§å°±åƒæ˜¯å¤§æ¥¼å®‰å…¨å·¡é€»ï¼Œå¿…é¡»æ—¶åˆ»å…³æ³¨æ¯ä¸ª"é—¨"çš„çŠ¶æ€ã€‚ä¸€ä¸ªç«¯å£å‡ºé—®é¢˜ï¼Œæ•´ä¸ªåº”ç”¨å°±æ— æ³•å¯¹å¤–æä¾›æœåŠ¡ã€‚åœ¨å‡ºé”™çš„ç¬¬ä¸€æ—¶é—´å°±éœ€è¦è¢«å‘ç°å¹¶ä¸ŠæŠ¥è¿›è¡Œå¤„ç†ã€‚
å·²æœ‰æœ€ä½³å®è·µï¼š
NOC é€šè¿‡ç›‘æ§ç³»ç»Ÿå‘ç°ç«¯å£æ— æ³•è®¿é—®ï¼Œä¸ŠæŠ¥è‡³SREè¿›è¡Œæ£€æŸ¥ä¿®å¤ï¼Œå°½å¿«ä¿®å¤ã€‚åŒæ—¶é€šçŸ¥åº”ç”¨çš„å®¢æˆ·å¯èƒ½å¸¦æ¥çš„å½±å“ã€‚ ğŸ‘
æœªæ¥è¶‹åŠ¿ï¼š
AI ä¼šè‡ªåŠ¨æ£€æµ‹ç«¯å£å¼‚å¸¸ï¼Œæ‰§è¡Œé¢„è®¾çš„æ¢å¤è„šæœ¬ï¼ˆé‡å¯æœåŠ¡ã€åˆ‡æ¢å¤‡ç”¨ç«¯å£ç­‰ï¼‰ï¼Œæ— æ³•è‡ªåŠ¨æ¢å¤æ—¶æ‰å‡çº§åˆ°SREğŸ®

----- English
Chapter 1: Server Ports - The Address System of the Digital World

Hello everyone! Today let's talk about a seemingly simple but extremely important infrastructure topic: server ports. If we compare a server to a building, then ports are like room numbers for each room - without them, you can't find any service!

1ï¸âƒ£ What are Ports? Server "Room Numbers" ğŸ 

Imagine you need to visit a company in an office building. You know the company is in "Tech Tower," but this building has 50 floors with 20 rooms per floor - how would you find it without room numbers? Ports are exactly these room numbers!

Server Port Functions:
ğŸ‘‰ Unique identification: Each port corresponds to a specific service
ğŸ‘‰ Traffic distribution: Different requests enter different services through different ports
ğŸ‘‰ Resource isolation: Services don't interfere with each other, each occupying independent ports
ğŸ‘‰ Concurrent processing: The same server can provide multiple services simultaneously

For example ğŸŒ°, the ports listed are like rooms in an office building:
ğŸ‘‰ Port 22 = Security office (SSH remote login)
ğŸ‘‰ Port 80 = Front lobby (HTTP web service)
ğŸ‘‰ Port 443 = VIP reception room (HTTPS secure service)
ğŸ‘‰ Port 3306 = Archive room (MySQL database)

2ï¸âƒ£ External Services Must Have Ports: No Room Number Means "Illegal Resident" ğŸšª

In the digital world, any application that wants to provide external services must have a port - this is an iron rule! Just like companies must have room numbers, services without ports are "illegal residents" that nobody can find.

Why do all external services need ports?

Basic principles of network communication:
ğŸ‘‰ IP address: Determines which server (which building)
ğŸ‘‰ Port number: Determines which service (which room)
ğŸ‘‰ Protocol: Determines how to communicate (how to knock on the door)

3ï¸âƒ£ Port Classification

ğŸ‘‰ Well-known ports (0-1023): System reserved, require administrator privileges
ğŸ‘‰ Registered ports (1024-49151): Used by applications
ğŸ‘‰ Dynamic ports (49152-65535): Temporarily allocated for use

4ï¸âƒ£ Port Monitoring: SRE's "Security Patrol" ğŸ‘®â€â™‚ï¸

As an SRE, port monitoring is like building security patrol - you must constantly watch the status of every "door." When a port has problems, the entire application cannot provide external services. Issues must be discovered and reported for handling at the first moment they occur.

Current Best Practices:
NOC discovers port inaccessibility through monitoring systems, reports to SRE for inspection and repair, and fixes as quickly as possible. Meanwhile, notifies application customers of potential impacts. ğŸ‘

Future Trends:
AI will automatically detect port anomalies, execute preset recovery scripts (restart services, switch to backup ports, etc.), and only escalate to SRE when automatic recovery fails ğŸ®


ä¸¾ä¸ªæ —å­ï¼š
```bash
# æŸ¥çœ‹æœåŠ¡å™¨ç«¯å£ä½¿ç”¨æƒ…å†µ
netstat -tlnp
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1234/sshd
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      5678/nginx
tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      5678/nginx
tcp        0      0 0.0.0.0:3306            0.0.0.0:*               LISTEN      9012/mysqld
```

ç« èŠ‚2: æœåŠ¡å™¨ç«¯å£ï¼šSREçš„æ£€æŸ¥æ¸…å•
å¤§å®¶å¥½ï¼Œå‰ç¯‡ä»‹ç»äº†ç«¯å£çš„é‡è¦æ€§ï¼Œä»Šå¤©æ¥èŠèŠä½œä¸ºSREï¼Œå¦‚ä½•ç›‘æ§ç«¯å£å¥åº·çŠ¶æ€ã€‚
1ï¸âƒ£ ç«¯å£å¥åº·æ£€æŸ¥åˆ†ç±»ï¼š
ğŸ‘‰ å¼€æºå·¥å…·ç±»ï¼š
1. Prometheus blackboxï¼šé€šè¿‡ä¸»æœºå + ç«¯å£å·çš„æ–¹å¼è¿›è¡Œç«¯å£çš„å¥åº·æ£€æŸ¥ï¼Œç”Ÿæˆæ£€æŸ¥æŒ‡æ ‡
2. Prometheus: é€šè¿‡scrapeç›®æ ‡çš„metricsç«¯ç‚¹æ¥æ”¶é›†æŒ‡æ ‡ï¼ŒåŒæ—¶éªŒè¯ç«¯å£è¿é€šæ€§
3. å…¶ä»–å·¥å…·è¯¸å¦‚ icingaã€zabbixç­‰

ğŸ‘‰ å‘½ä»¤è¡Œç±»ï¼š
1. nmapï¼šæ‰«æç«¯å£å¼€æ”¾æƒ…å†µ
2. telnet/ncï¼šæ£€æŸ¥ç«¯å£è¿é€šæ€§
3. curlï¼šæ£€æŸ¥HTTPæœåŠ¡å“åº”
4. ss/netstatï¼šæ£€æŸ¥ç«¯å£è¿æ¥çŠ¶æ€

ğŸ‘‰ å¼€å‘ç«¯å£æ‰«æå·¥å…·
1. ç¼–ç¨‹è¯­è¨€é€šè¿‡socketå‘½ä»¤ï¼ŒæŒ‡å®šä¸»æœºå + ç«¯å£å·æ¥è¿›è¡Œè¿æ¥ï¼Œå¦‚æœsocketè¿æ¥æˆåŠŸï¼Œè¯´æ˜ç«¯å£æ˜¯å¥åº·çš„ï¼Œéœ€è¦å®šæœŸè°ƒåº¦æ‰§è¡Œå¹¶ç”Ÿæˆå®šåˆ¶åŒ–æŒ‡æ ‡ï¼Œå¦åˆ™æ— æ³•æš´éœ²ç»“æœ
2. ç¼–å†™bashè„šæœ¬ï¼Œå®šæœŸè°ƒåº¦æ‰§è¡Œï¼Œç”Ÿæˆå®šåˆ¶åŒ–çš„æŒ‡æ ‡ï¼Œæš´éœ²ç»“æœï¼Œä¾‹å­å¦‚ä¸‹ï¼š
```bash
# ç«¯å£å¥åº·æ£€æŸ¥è„šæœ¬
#!/bin/bash
check_port() {
    local host=$1
    local port=$2
    local service=$3

    if timeout 5 bash -c "</dev/tcp/$host/$port"; then
        echo "âœ… $service ($host:$port) is UP"
        return 0
    else
        echo "âŒ $service ($host:$port) is DOWN"
        # å‘é€å‘Šè­¦é€šçŸ¥:é‚®ä»¶ï¼Œå³æ—¶é€šè®¯å·¥å…·
        send_alert "$service service is down! ($host:$port)"
        return 1
    fi
}

# æ‰¹é‡æ£€æŸ¥å…³é”®ç«¯å£
check_port "192.168.1.100" "80" "WebæœåŠ¡"
check_port "192.168.1.101" "3306" "MySQLæ•°æ®åº“"
check_port "192.168.1.102" "6379" "Redisç¼“å­˜"
check_port "192.168.1.103" "22" "SSHè¿œç¨‹ç™»å½•"
```

2ï¸âƒ£ ç«¯å£å‡ºé”™åˆ†ç±»ï¼š
ğŸ‘‰ ç«¯å£æ— å“åº”
ğŸ‘‰ ç«¯å£å“åº”æ…¢
ğŸ‘‰ ç«¯å£è¿æ¥æ•°è¿‡å¤š
ğŸ‘‰ ç«¯å£è¢«æ¶æ„æ‰«æ

3ï¸âƒ£ SREç«¯å£ç›‘æ§æœ€ä½³å®è·µï¼š
ğŸ‘‰ å¤šå±‚æ¬¡ç›‘æ§ï¼š
åŸºç¡€ç›‘æ§ï¼šç«¯å£æ˜¯å¦ç›‘å¬
åŠŸèƒ½ç›‘æ§ï¼šæœåŠ¡æ˜¯å¦æ­£å¸¸å“åº”
æ€§èƒ½ç›‘æ§ï¼šå“åº”æ—¶é—´å’Œååé‡
å®‰å…¨ç›‘æ§ï¼šå¼‚å¸¸è¿æ¥å’Œæ”»å‡»æ£€æµ‹

ğŸ‘‰ è‡ªåŠ¨åŒ–æ£€æµ‹ï¼Œæ£€æŸ¥åˆ†ç±»æåˆ°çš„æ‰€æœ‰å·¥å…·å‡å¯ç”¨äºè‡ªåŠ¨åŒ–æ£€æµ‹

ğŸ‘‰ ç«¯å£å®‰å…¨ç®¡ç†ï¼š
æœ€å°åŒ–åŸåˆ™ï¼šåªå¼€æ”¾å¿…è¦çš„ç«¯å£
è®¿é—®æ§åˆ¶ï¼šä½¿ç”¨é˜²ç«å¢™é™åˆ¶ç«¯å£è®¿é—®
å®šæœŸå®¡è®¡ï¼šæ£€æŸ¥æ˜¯å¦æœ‰æœªæˆæƒçš„ç«¯å£å¼€æ”¾
ç«¯å£æ‰«æé˜²æŠ¤ï¼šæ£€æµ‹å’Œé˜»æ­¢æ¶æ„æ‰«æ

4ï¸âƒ£ ç«¯å£æ•…éšœæ’æŸ¥ï¼šSREçš„"ç ´æ¡ˆç¥æŠ€" ğŸ”
å½“ç«¯å£å‡ºé—®é¢˜æ—¶ï¼ŒSREå°±åƒä¾¦æ¢ä¸€æ ·ï¼Œè¦å¿«é€Ÿå®šä½é—®é¢˜æ ¹å› ï¼š
ğŸ‘‰ å¿«é€Ÿå“åº”ï¼šç«‹å³æ£€æŸ¥æœåŠ¡çŠ¶æ€å’Œç«¯å£ç›‘å¬
ğŸ‘‰ å½±å“è¯„ä¼°ï¼šç¡®å®šæ•…éšœå½±å“èŒƒå›´å’Œç”¨æˆ·æ•°é‡
ğŸ‘‰ ä¸´æ—¶æ¢å¤ï¼šä¼˜å…ˆæ¢å¤æœåŠ¡ï¼Œå†æŸ¥æ‰¾æ ¹å› 
ğŸ‘‰ æ ¹å› åˆ†æï¼šæ·±å…¥åˆ†ææ•…éšœåŸå› 
ğŸ‘‰ é¢„é˜²æªæ–½ï¼šåˆ¶å®šé¢„é˜²ç±»ä¼¼é—®é¢˜çš„æ–¹æ¡ˆ

5ï¸âƒ£ AIæ£€æµ‹ï¼š
ğŸ‘‰ å¼‚å¸¸æ¨¡å¼è¯†åˆ«ï¼šåŸºäºå†å²æ•°æ®å­¦ä¹ æ­£å¸¸è¡Œä¸ºæ¨¡å¼
ğŸ‘‰ æ™ºèƒ½å‘Šè­¦é™å™ªï¼šå‡å°‘è¯¯æŠ¥ï¼Œæé«˜å‘Šè­¦è´¨é‡
ğŸ‘‰ è‡ªåŠ¨æ•…éšœæ¢å¤ï¼šé¢„è®¾æ¢å¤ç­–ç•¥çš„æ™ºèƒ½æ‰§è¡Œ
ğŸ‘‰ é¢„æµ‹æ€§ç»´æŠ¤ï¼šæå‰é¢„è­¦æ½œåœ¨é—®é¢˜
å¤§å®¶è§‰å¾—è¿˜æœ‰å“ªäº›AIåº”ç”¨åœºæ™¯ï¼Ÿæ¬¢è¿è®¨è®ºï¼

ç«¯å£å°±åƒæ•°å­—ä¸–ç•Œé‡Œæ¯ä¸ªæœåŠ¡çš„é—¨ç‰Œå·â€”â€”æ²¡æœ‰é—¨ç‰Œå·ï¼Œå†å¥½çš„æœåŠ¡ä¹Ÿæ˜¯"é»‘æˆ·"ï¼›é—¨ç‰Œå·å‡ºé—®é¢˜ï¼Œç”¨æˆ·å°±æ‰¾ä¸åˆ°ä½ çš„æœåŠ¡ã€‚ä½œä¸ºSREï¼Œç›‘æ§ç«¯å£å°±åƒå¤§æ¥¼å®‰å…¨å·¡é€»ï¼Œå¿…é¡»ç¡®ä¿æ¯ä¸ª"é—¨"éƒ½æ­£å¸¸å¼€æ”¾ï¼Œå“åº”åŠæ—¶ï¼Œå®‰å…¨å¯é ï¼   

----- English
Server Portsï¼šSRE's CheckÂ list
Hello everyone, the previous chapter introduced the importance of ports. Today let's talk about how to monitor port health status as an SRE.

1ï¸âƒ£ Port Health Check Classification:

ğŸ‘‰ Open Source Tools:
1. Prometheus blackbox: Performs port health checks through hostname + port number, generating check metrics
2. Prometheus: Collects metrics through scrape target metrics endpoints while verifying port connectivity
3. Other tools such as Icinga, Zabbix, etc.

ğŸ‘‰ Command Line Tools:
1. nmap: Scans port availability
2. telnet/nc: Checks port connectivity
3. curl: Checks HTTP service response
4. ss/netstat: Checks port connection status

ğŸ‘‰ Develop Port Scanning Tools:
1. Programming languages use socket commands, specifying hostname + port number for connection. If socket connection succeeds, the port is healthy. Need to schedule regular execution and generate customized metrics, otherwise results cannot be exposed.
2. Write bash scripts, schedule regular execution, generate customized metrics, expose results. Example as follows:

```bash
# Port health check script
#!/bin/bash
check_port() {
    local host=$1
    local port=$2
    local service=$3

    if timeout 5 bash -c "</dev/tcp/$host/$port"; then
        echo "âœ… $service ($host:$port) is UP"
        return 0
    else
        echo "âŒ $service ($host:$port) is DOWN"
        # Send alert notification: email, instant messaging tools
        send_alert "$service service is down! ($host:$port)"
        return 1
    fi
}

# Batch check critical ports
check_port "192.168.1.100" "80" "Web Service"
check_port "192.168.1.101" "3306" "MySQL Database"
check_port "192.168.1.102" "6379" "Redis Cache"
check_port "192.168.1.103" "22" "SSH Remote Login"
```

2ï¸âƒ£ Port Error Classification:
ğŸ‘‰ Port unresponsive
ğŸ‘‰ Slow port response
ğŸ‘‰ Too many port connections
ğŸ‘‰ Port being maliciously scanned

3ï¸âƒ£ SRE Port Monitoring Best Practices:

ğŸ‘‰ Multi-level Monitoring:
Basic monitoring: Whether ports are listening
Functional monitoring: Whether services respond normally
Performance monitoring: Response time and throughput
Security monitoring: Abnormal connections and attack detection

ğŸ‘‰ Automated detection - all tools mentioned in the check classification can be used for automated detection

ğŸ‘‰ Port Security Management:
Minimization principle: Only open necessary ports
Access control: Use firewalls to restrict port access
Regular audits: Check for unauthorized open ports
Port scan protection: Detect and block malicious scanning

4ï¸âƒ£ Port Troubleshooting: SRE's "Detective Skills" ğŸ”
When ports have problems, SREs act like detectives to quickly locate the root cause:
ğŸ‘‰ Rapid response: Immediately check service status and port listening
ğŸ‘‰ Impact assessment: Determine fault impact scope and user count
ğŸ‘‰ Temporary recovery: Prioritize service restoration, then find root cause
ğŸ‘‰ Root cause analysis: Deep analysis of fault reasons
ğŸ‘‰ Preventive measures: Develop plans to prevent similar issues

5ï¸âƒ£ AI Detection:
ğŸ‘‰ Anomaly pattern recognition: Learn normal behavior patterns based on historical data
ğŸ‘‰ Intelligent alert noise reduction: Reduce false positives, improve alert quality
ğŸ‘‰ Automated fault recovery: Intelligent execution of preset recovery strategies
ğŸ‘‰ Predictive maintenance: Early warning of potential issues
What other AI application scenarios do you think there are? Welcome to discuss!

Ports are like room numbers for every service in the digital world - without room numbers, even the best services are "illegal residents"; when room numbers have problems, users can't find your service. As an SRE, monitoring ports is like building security patrol - you must ensure every "door" is normally open, responds promptly, and remains secure and reliable!
